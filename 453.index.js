(globalThis.webpackChunkhtmf=globalThis.webpackChunkhtmf||[]).push([[453],{942:(e,t,n)=>{"use strict";n.d(t,{lA:()=>b,h4:()=>M,h9:()=>P,Dz:()=>k,kF:()=>S,ug:()=>O,C2:()=>T,cx:()=>A,rY:()=>I,Wl:()=>x,UE:()=>E,Im:()=>j,dS:()=>C,Oi:()=>D,gl:()=>U,qw:()=>q,m_:()=>F,UL:()=>G,tS:()=>R,R$:()=>Y,md:()=>z,IF:()=>L,XP:()=>N,zP:()=>V,uQ:()=>$,td:()=>B,Ct:()=>H,RV:()=>Q,iY:()=>W,eY:()=>X,Or:()=>J,nD:()=>K,oH:()=>Z});var r=n(45);e=n.hmd(e);let s=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});s.decode();let i=null;function o(){return null!==i&&i.buffer===r.memory.buffer||(i=new Uint8Array(r.memory.buffer)),i}function a(e,t){return s.decode(o().subarray(e,e+t))}const u=new Array(32).fill(void 0);u.push(void 0,null,!0,!1);let c=u.length;function l(e){c===u.length&&u.push(u.length+1);const t=c;return c=u[t],u[t]=e,t}function _(e){return u[e]}function p(e){const t=_(e);return function(e){e<36||(u[e]=c,c=e)}(e),t}let f=null;function g(){return null!==f&&f.buffer===r.memory.buffer||(f=new Int32Array(r.memory.buffer)),f}function d(e,t){return o().subarray(e/1,e/1+t)}let h=0,m=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const v="function"==typeof m.encodeInto?function(e,t){return m.encodeInto(e,t)}:function(e,t){const n=m.encode(e);return t.set(n),{read:e.length,written:n.length}};function y(e,t){try{return e.apply(this,t)}catch(e){r.__wbindgen_exn_store(l(e))}}class b{static __wrap(e){const t=Object.create(b.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_game_free(e)}static new(){var e=r.game_new();return b.__wrap(e)}is_drafting(){return 0!==r.game_is_drafting(this.ptr)}finished_drafting(){return 0!==r.game_finished_drafting(this.ptr)}game_over(){return 0!==r.game_game_over(this.ptr)}active_player(){var e=r.game_active_player(this.ptr);return 16777215===e?void 0:e}score(e){return r.game_score(this.ptr,e)>>>0}turn(){return r.game_turn(this.ptr)>>>0}num_fish(e){return r.game_num_fish(this.ptr,e)>>>0}penguins(e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.game_penguins(i,this.ptr,e);var t=g()[i/4+0],n=g()[i/4+1],s=d(t,n).slice();return r.__wbindgen_free(t,1*n),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}claimed(e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.game_claimed(i,this.ptr,e);var t=g()[i/4+0],n=g()[i/4+1],s=d(t,n).slice();return r.__wbindgen_free(t,1*n),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}draftable_cells(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.game_draftable_cells(s,this.ptr);var e=g()[s/4+0],t=g()[s/4+1],n=d(e,t).slice();return r.__wbindgen_free(e,1*t),n}finally{r.__wbindgen_add_to_stack_pointer(16)}}possible_moves(e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.game_possible_moves(i,this.ptr,e);var t=g()[i/4+0],n=g()[i/4+1],s=d(t,n).slice();return r.__wbindgen_free(t,1*n),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}place_penguin(e){r.game_place_penguin(this.ptr,e)}move_penguin(e,t){r.game_move_penguin(this.ptr,e,t)}playout(){r.game_playout(this.ptr)}get_visits(){return r.game_get_visits(this.ptr)}place_info(e){var t=r.game_place_info(this.ptr,e);return w.__wrap(t)}move_info(e,t){var n=r.game_move_info(this.ptr,e,t);return w.__wrap(n)}take_action(){r.game_take_action(this.ptr)}}class w{static __wrap(e){const t=Object.create(w.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_moveinfo_free(e)}get_visits(){return r.moveinfo_get_visits(this.ptr)}get_rewards(){return r.moveinfo_get_rewards(this.ptr)}}function M(e,t){return l(a(e,t))}function P(){return l(new Error)}function k(e,t){var n=function(e,t,n){if(void 0===n){const n=m.encode(e),r=t(n.length);return o().subarray(r,r+n.length).set(n),h=n.length,r}let r=e.length,s=t(r);const i=o();let a=0;for(;a<r;a++){const t=e.charCodeAt(a);if(t>127)break;i[s+a]=t}if(a!==r){0!==a&&(e=e.slice(a)),s=n(s,r,r=a+3*e.length);const t=o().subarray(s+a,s+r);a+=v(e,t).written}return h=a,s}(_(t).stack,r.__wbindgen_malloc,r.__wbindgen_realloc),s=h;g()[e/4+1]=s,g()[e/4+0]=n}function S(e,t){try{console.error(a(e,t))}finally{r.__wbindgen_free(e,t)}}function O(e){p(e)}function T(){return y((function(e,t){_(e).getRandomValues(_(t))}),arguments)}function A(){return y((function(e,t,n){_(e).randomFillSync(d(t,n))}),arguments)}function I(e){return l(_(e).process)}function x(e){const t=_(e);return"object"==typeof t&&null!==t}function E(e){return l(_(e).versions)}function j(e){return l(_(e).node)}function C(){return y((function(e,t){return l(n(989)(a(e,t)))}),arguments)}function D(e){return l(_(e).crypto)}function U(e){return l(_(e).msCrypto)}function q(){return y((function(e,t){return l(_(e).call(_(t)))}),arguments)}function F(e){return l(_(e))}function G(e,t){return l(new Function(a(e,t)))}function R(){return y((function(){return l(self.self)}),arguments)}function Y(){return y((function(){return l(window.window)}),arguments)}function z(){return y((function(){return l(globalThis.globalThis)}),arguments)}function L(){return y((function(){return l(n.g.global)}),arguments)}function N(e){return void 0===_(e)}function V(e){return l(_(e).buffer)}function $(e){return _(e).length}function B(e){return l(new Uint8Array(_(e)))}function H(e,t,n){_(e).set(_(t),n>>>0)}function Q(e){return l(new Uint8Array(e>>>0))}function W(e,t,n){return l(_(e).subarray(t>>>0,n>>>0))}function X(e){return"string"==typeof _(e)}function J(e,t){throw new Error(a(e,t))}function K(e){throw p(e)}function Z(){return l(r.memory)}},45:(e,t,n)=>{"use strict";var r=n.w[e.id];e.exports=r,n(942),r[""]()},989:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=989,e.exports=t},453:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n(942);const s=class{constructor(e){Object.defineProperty(this,"game",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ponderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nplayouts",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.game=r.lA.new(),this.postMessage=e,this.ponder()}free(){this.stopPondering(),this.game.free()}init(){const e=this.postMessage;e({type:"state",gameState:this.getState()}),e({type:"possibleMoves",possibleMoves:this.getPossibleMoves()})}ponder(){this.nplayouts=this.game.get_visits(),void 0===this.ponderer&&(this.ponderer=self.setInterval((()=>{if(this.nplayouts>=6e4)return void this.stopPondering();const e=performance.now();for(;performance.now()-e<100;)this.playout();let t=this.game.active_player();void 0!==t&&(this.game.is_drafting()?this.postPlaceScores(t):this.postMoveScores(t))}),0))}stopPondering(){void 0!==this.ponderer&&(self.clearInterval(this.ponderer),this.ponderer=void 0)}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout(),++this.nplayouts}takeAction(){this.stopPondering();const e=this.postMessage,t=this.game.turn()<2?28e3:14e3;for(;this.nplayouts<t;)this.playout(),this.nplayouts%100==0&&e({type:"thinkingProgress",completed:this.nplayouts,required:t});this.game.take_action(),this.ponder()}getState(){return function(e){const t=[];for(let n=0;n<60;++n)t.push(e.num_fish(n));const n=[],r=[],s=[];for(let t=0;t<2;++t)n.push(e.score(t)),r.push([...e.penguins(t)]),s.push([...e.claimed(t)]);return{activePlayer:e.active_player(),modeType:e.finished_drafting()?"playing":"drafting",scores:n,turn:e.turn(),board:{fish:t,penguins:r,claimed:s}}}(this.game)}getPossibleMoves(e){return function(e,t){if(0!=e.active_player())return[];if(e.finished_drafting()){if(void 0!==t)return[...e.possible_moves(t)];const n=e.active_player();return void 0===n?[]:[...e.penguins(n)]}return[...e.draftable_cells()]}(this.game,e)}onMessage(e){switch(console.log(`received request ${e.type}`),e.type){case"get":this.postGameState();break;case"move":try{this.movePenguin(e.src,e.dst),this.postGameState()}catch(t){this.postIllegalMove(e.src,e.dst)}break;case"place":try{this.placePenguin(e.dst),this.postGameState()}catch(t){this.postIllegalPlacement(e.dst)}break;case"possibleMoves":this.postPossibleMoves(e.src);break;case"takeAction":this.takeAction(),this.postGameState()}}postIllegalMove(e,t){(0,this.postMessage)({type:"illegalMove",src:e,dst:t})}postIllegalPlacement(e){(0,this.postMessage)({type:"illegalPlacement",dst:e})}postPossibleMoves(e){(0,this.postMessage)({type:"possibleMoves",possibleMoves:this.getPossibleMoves(e)})}postGameState(){(0,this.postMessage)({type:"state",gameState:this.getState()})}postPlaceScores(e){const t=[];for(let e of this.game.draftable_cells()){const n=this.game.place_info(e);t.push({dst:e,visits:n.get_visits(),rewards:n.get_rewards()})}(0,this.postMessage)({type:"placeScores",activePlayer:e,placeScores:t})}postMoveScores(e){const t=[];for(let n of this.game.penguins(e))for(let e of this.game.possible_moves(n)){const r=this.game.move_info(n,e);t.push({src:n,dst:e,visits:r.get_visits(),rewards:r.get_rewards()})}(0,this.postMessage)({type:"moveScores",activePlayer:e,moveScores:t})}}}}]);