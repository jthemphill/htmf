(self.webpackChunkhtmf=self.webpackChunkhtmf||[]).push([[175],{942:(e,t,n)=>{"use strict";e.exports=(async()=>{n.d(t,{lA:()=>v,h4:()=>w,h9:()=>y,Dz:()=>x,kF:()=>M,ug:()=>P,f4:()=>k,oS:()=>S,I9:()=>I,ii:()=>D,to:()=>T,XP:()=>E,py:()=>O,Or:()=>F,nD:()=>G});var r=n(45);e=n.hmd(e),r=await Promise.resolve(r);let s=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});s.decode();let i=null;function o(){return null!==i&&i.buffer===r.memory.buffer||(i=new Uint8Array(r.memory.buffer)),i}function a(e,t){return s.decode(o().subarray(e,e+t))}const _=new Array(32).fill(void 0);_.push(void 0,null,!0,!1);let l=_.length;function u(e){l===_.length&&_.push(_.length+1);const t=l;return l=_[t],_[t]=e,t}function c(e){return _[e]}function p(e){const t=c(e);return function(e){e<36||(_[e]=l,l=e)}(e),t}let g=null;function d(){return null!==g&&g.buffer===r.memory.buffer||(g=new Int32Array(r.memory.buffer)),g}function f(e,t){return o().subarray(e/1,e/1+t)}let h=0,b=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const m="function"==typeof b.encodeInto?function(e,t){return b.encodeInto(e,t)}:function(e,t){const n=b.encode(e);return t.set(n),{read:e.length,written:n.length}};class v{static __wrap(e){const t=Object.create(v.prototype);return t.ptr=e,t}free(){const e=this.ptr;this.ptr=0,r.__wbg_game_free(e)}static new(){var e=r.game_new();return v.__wrap(e)}is_drafting(){return 0!==r.game_is_drafting(this.ptr)}finished_drafting(){return 0!==r.game_finished_drafting(this.ptr)}game_over(){return 0!==r.game_game_over(this.ptr)}active_player(){var e=r.game_active_player(this.ptr);return 16777215===e?void 0:e}score(e){return r.game_score(this.ptr,e)>>>0}turn(){return r.game_turn(this.ptr)>>>0}num_fish(e){return r.game_num_fish(this.ptr,e)>>>0}penguins(e){try{const i=r.__wbindgen_export_0.value-16;r.__wbindgen_export_0.value=i,r.game_penguins(i,this.ptr,e);var t=d()[i/4+0],n=d()[i/4+1],s=f(t,n).slice();return r.__wbindgen_free(t,1*n),s}finally{r.__wbindgen_export_0.value+=16}}claimed(e){try{const i=r.__wbindgen_export_0.value-16;r.__wbindgen_export_0.value=i,r.game_claimed(i,this.ptr,e);var t=d()[i/4+0],n=d()[i/4+1],s=f(t,n).slice();return r.__wbindgen_free(t,1*n),s}finally{r.__wbindgen_export_0.value+=16}}draftable_cells(){try{const s=r.__wbindgen_export_0.value-16;r.__wbindgen_export_0.value=s,r.game_draftable_cells(s,this.ptr);var e=d()[s/4+0],t=d()[s/4+1],n=f(e,t).slice();return r.__wbindgen_free(e,1*t),n}finally{r.__wbindgen_export_0.value+=16}}possible_moves(e){try{const i=r.__wbindgen_export_0.value-16;r.__wbindgen_export_0.value=i,r.game_possible_moves(i,this.ptr,e);var t=d()[i/4+0],n=d()[i/4+1],s=f(t,n).slice();return r.__wbindgen_free(t,1*n),s}finally{r.__wbindgen_export_0.value+=16}}place_penguin(e){r.game_place_penguin(this.ptr,e)}move_penguin(e,t){r.game_move_penguin(this.ptr,e,t)}playout(){r.game_playout(this.ptr)}take_action(){r.game_take_action(this.ptr)}}const w=function(e,t){return u(a(e,t))},y=function(){return u(new Error)},x=function(e,t){var n=function(e,t,n){if(void 0===n){const n=b.encode(e),r=t(n.length);return o().subarray(r,r+n.length).set(n),h=n.length,r}let r=e.length,s=t(r);const i=o();let a=0;for(;a<r;a++){const t=e.charCodeAt(a);if(t>127)break;i[s+a]=t}if(a!==r){0!==a&&(e=e.slice(a)),s=n(s,r,r=a+3*e.length);const t=o().subarray(s+a,s+r);a+=m(e,t).written}return h=a,s}(c(t).stack,r.__wbindgen_malloc,r.__wbindgen_realloc),s=h;d()[e/4+1]=s,d()[e/4+0]=n},M=function(e,t){try{console.error(a(e,t))}finally{r.__wbindgen_free(e,t)}},P=function(e){p(e)},k=function(e,t,n){c(e).getRandomValues(f(t,n))},S=function(e,t,n){c(e).randomFillSync(f(t,n))},I=(A=function(){return u(self.self)},function(){try{return A.apply(this,arguments)}catch(e){r.__wbindgen_exn_store(u(e))}});var A;const D=function(e,t){return u(n(989)(a(e,t)))},T=function(e){return u(c(e).crypto)},E=function(e){return void 0===c(e)},O=function(e){return u(c(e).getRandomValues)},F=function(e,t){throw new Error(a(e,t))},G=function(e){throw p(e)};return t})()},45:(e,t,n)=>{"use strict";var r=n(942);e.exports=Promise.resolve(r).then((r=>n.v(t,e.id,"d2a3a9b803819b3d0475",{"./htmf_wasm_bg.js":{__wbindgen_string_new:r.h4,__wbg_new_59cb74e423758ede:r.h9,__wbg_stack_558ba5917b466edd:r.Dz,__wbg_error_4bb6c2a97407129a:r.kF,__wbindgen_object_drop_ref:r.ug,__wbg_getRandomValues_f5e14ab7ac8e995d:r.f4,__wbg_randomFillSync_d5bd2d655fdf256a:r.oS,__wbg_self_1b7a39e3a92c949c:r.I9,__wbg_require_604837428532a733:r.ii,__wbg_crypto_968f1772287e2df0:r.to,__wbindgen_is_undefined:r.XP,__wbg_getRandomValues_a3d34b4fee3c2869:r.py,__wbindgen_throw:r.Or,__wbindgen_rethrow:r.nD}})))},989:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=989,e.exports=t},175:(e,t,n)=>{"use strict";e.exports=(async()=>{n.r(t),n.d(t,{default:()=>s});var e=n(942),r=n(209);e=await Promise.resolve(e);const s=class{constructor(t){this.game=e.lA.new(),this.postMessage=t,this.nplayouts=0}free(){this.stopPondering(),this.game.free()}init(){const e=this.postMessage;e({type:"state",gameState:this.getState()}),e({type:"possibleMoves",possibleMoves:this.getPossibleMoves()})}ponder(){this.nplayouts=0,null==this.ponderer&&(this.ponderer=self.setInterval((()=>{if(this.nplayouts>=r.BS)return void this.stopPondering();const e=performance.now();for(;performance.now()-e<r._U;)this.playout()}),r.c9))}stopPondering(){null!=this.ponderer&&(self.clearInterval(this.ponderer),this.ponderer=void 0)}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout(),++this.nplayouts}takeAction(){for(this.stopPondering();this.nplayouts<r.BS;)this.playout();this.game.take_action(),this.ponder()}getState(){return function(e){const t=[];for(let n=0;n<r.JQ;++n)t.push(e.num_fish(n));const n=[],s=[],i=[];for(let t=0;t<r.Zp;++t)n.push(e.score(t)),s.push([...e.penguins(t)]),i.push([...e.claimed(t)]);return{activePlayer:e.active_player(),modeType:e.finished_drafting()?"playing":"drafting",scores:n,turn:e.turn(),board:{fish:t,penguins:s,claimed:i}}}(this.game)}getPossibleMoves(e){return function(e,t){if(e.active_player()!=r.Jh)return[];if(e.finished_drafting()){if(null!=t)return[...e.possible_moves(t)];const n=e.active_player();return null==n?[]:[...e.penguins(n)]}return[...e.draftable_cells()]}(this.game,e)}onMessage(e){switch(console.log("received request "+e.type),e.type){case"get":this.postGameState();break;case"move":try{this.movePenguin(e.src,e.dst),this.postGameState()}catch(t){this.postIllegalMove(e.src,e.dst)}break;case"place":try{this.placePenguin(e.dst),this.postGameState()}catch(t){this.postIllegalPlacement(e.dst)}break;case"possibleMoves":this.postPossibleMoves(e.src);break;case"takeAction":this.takeAction(),this.postGameState()}}postIllegalMove(e,t){(0,this.postMessage)({type:"illegalMove",src:e,dst:t})}postIllegalPlacement(e){(0,this.postMessage)({type:"illegalPlacement",dst:e})}postPossibleMoves(e){(0,this.postMessage)({type:"possibleMoves",possibleMoves:this.getPossibleMoves(e)})}postGameState(){(0,this.postMessage)({type:"state",gameState:this.getState()})}};return t})()},209:(e,t,n)=>{"use strict";n.d(t,{Zp:()=>r,Jh:()=>s,JQ:()=>i,_U:()=>o,BS:()=>_,c9:()=>a});const r=2,s=0,i=60,o=100,a=0,_=6e3}}]);