"use strict";(globalThis.webpackChunkhtmf=globalThis.webpackChunkhtmf||[]).push([[142],{942:(e,t,n)=>{n.a(e,(async(r,s)=>{try{n.d(t,{EF:()=>X,Ih:()=>A,Ip:()=>z,KQ:()=>K,NT:()=>F,OF:()=>Z,Oo:()=>ee,Or:()=>re,TL:()=>J,Wl:()=>E,XP:()=>W,YN:()=>ne,ZL:()=>G,_3:()=>Q,cb:()=>$,eY:()=>Y,gk:()=>j,h4:()=>O,lA:()=>S,mR:()=>D,m_:()=>R,mm:()=>N,oH:()=>se,pk:()=>x,qc:()=>B,rC:()=>te,sP:()=>L,u:()=>C,ug:()=>q,vm:()=>V,wA:()=>U,xB:()=>H,yq:()=>I});var i=n(335);e=n.hmd(e);var o=r([i]);i=(o.then?(await o)():o)[0];let _=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});_.decode();let a=null;function c(){return null!==a&&a.buffer===i.memory.buffer||(a=new Uint8Array(i.memory.buffer)),a}function u(e,t){return _.decode(c().subarray(e,e+t))}const l=new Array(32).fill(void 0);l.push(void 0,null,!0,!1);let d=l.length;function f(e){d===l.length&&l.push(l.length+1);const t=d;return d=l[t],l[t]=e,t}function g(e){return l[e]}function p(e){e<36||(l[e]=d,d=e)}function b(e){const t=g(e);return p(e),t}let h=null;function w(){return null!==h&&h.buffer===i.memory.buffer||(h=new Int32Array(i.memory.buffer)),h}function m(e,t){return c().subarray(e/1,e/1+t)}let y=0,v=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const k="function"==typeof v.encodeInto?function(e,t){return v.encodeInto(e,t)}:function(e,t){const n=v.encode(e);return t.set(n),{read:e.length,written:n.length}};function P(e,t,n){if(void 0===n){const n=v.encode(e),r=t(n.length);return c().subarray(r,r+n.length).set(n),y=n.length,r}let r=e.length,s=t(r);const i=c();let o=0;for(;o<r;o++){const t=e.charCodeAt(o);if(t>127)break;i[s+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),s=n(s,r,r=o+3*e.length);const t=c().subarray(s+o,s+r);o+=k(e,t).written}return y=o,s}function M(e,t){try{return e.apply(this,t)}catch(e){i.__wbindgen_exn_store(f(e))}}class S{static __wrap(e){const t=Object.create(S.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();i.__wbg_game_free(e)}static new(){const e=i.game_new();return S.__wrap(e)}is_drafting(){return 0!==i.game_is_drafting(this.ptr)}finished_drafting(){return 0!==i.game_finished_drafting(this.ptr)}game_over(){return 0!==i.game_game_over(this.ptr)}active_player(){const e=i.game_active_player(this.ptr);return 16777215===e?void 0:e}score(e){return i.game_score(this.ptr,e)>>>0}turn(){return i.game_turn(this.ptr)>>>0}num_fish(e){return i.game_num_fish(this.ptr,e)>>>0}penguins(e){try{const s=i.__wbindgen_add_to_stack_pointer(-16);i.game_penguins(s,this.ptr,e);var t=w()[s/4+0],n=w()[s/4+1],r=m(t,n).slice();return i.__wbindgen_free(t,1*n),r}finally{i.__wbindgen_add_to_stack_pointer(16)}}claimed(e){try{const s=i.__wbindgen_add_to_stack_pointer(-16);i.game_claimed(s,this.ptr,e);var t=w()[s/4+0],n=w()[s/4+1],r=m(t,n).slice();return i.__wbindgen_free(t,1*n),r}finally{i.__wbindgen_add_to_stack_pointer(16)}}draftable_cells(){try{const r=i.__wbindgen_add_to_stack_pointer(-16);i.game_draftable_cells(r,this.ptr);var e=w()[r/4+0],t=w()[r/4+1],n=m(e,t).slice();return i.__wbindgen_free(e,1*t),n}finally{i.__wbindgen_add_to_stack_pointer(16)}}possible_moves(e){try{const s=i.__wbindgen_add_to_stack_pointer(-16);i.game_possible_moves(s,this.ptr,e);var t=w()[s/4+0],n=w()[s/4+1],r=m(t,n).slice();return i.__wbindgen_free(t,1*n),r}finally{i.__wbindgen_add_to_stack_pointer(16)}}place_penguin(e){try{const n=i.__wbindgen_add_to_stack_pointer(-16);i.game_place_penguin(n,this.ptr,e);var t=w()[n/4+0];if(w()[n/4+1])throw b(t)}finally{i.__wbindgen_add_to_stack_pointer(16)}}move_penguin(e,t){try{const r=i.__wbindgen_add_to_stack_pointer(-16);i.game_move_penguin(r,this.ptr,e,t);var n=w()[r/4+0];if(w()[r/4+1])throw b(n)}finally{i.__wbindgen_add_to_stack_pointer(16)}}playout(){i.game_playout(this.ptr)}get_visits(){return i.game_get_visits(this.ptr)}place_info(e){const t=i.game_place_info(this.ptr,e);return T.__wrap(t)}move_info(e,t){const n=i.game_move_info(this.ptr,e,t);return T.__wrap(n)}take_action(){try{const t=i.__wbindgen_add_to_stack_pointer(-16);i.game_take_action(t,this.ptr);var e=w()[t/4+0];if(w()[t/4+1])throw b(e)}finally{i.__wbindgen_add_to_stack_pointer(16)}}}class T{static __wrap(e){const t=Object.create(T.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();i.__wbg_moveinfo_free(e)}get_visits(){return i.moveinfo_get_visits(this.ptr)}get_rewards(){return i.moveinfo_get_rewards(this.ptr)}}function O(e,t){return f(u(e,t))}function A(){return f(new Error)}function I(e,t){const n=P(g(t).stack,i.__wbindgen_malloc,i.__wbindgen_realloc),r=y;w()[e/4+1]=r,w()[e/4+0]=n}function j(e,t){try{console.error(u(e,t))}finally{i.__wbindgen_free(e,t)}}function q(e){b(e)}function x(e){return f(g(e).process)}function E(e){const t=g(e);return"object"==typeof t&&null!==t}function C(e){return f(g(e).versions)}function F(e){return f(g(e).node)}function Y(e){return"string"==typeof g(e)}function U(){return f(e)}function B(){return M((function(e,t,n){return f(g(e).require(u(t,n)))}),arguments)}function D(e){return f(g(e).crypto)}function G(e){return f(g(e).msCrypto)}function L(){return M((function(e,t){g(e).getRandomValues(g(t))}),arguments)}function N(){return M((function(e,t,n){g(e).randomFillSync(m(t,n))}),arguments)}function J(e,t){return f(new Function(u(e,t)))}function Q(){return M((function(e,t){return f(g(e).call(g(t)))}),arguments)}function R(e){return f(g(e))}function Z(){return M((function(){return f(self.self)}),arguments)}function H(){return M((function(){return f(window.window)}),arguments)}function K(){return M((function(){return f(globalThis.globalThis)}),arguments)}function V(){return M((function(){return f(n.g.global)}),arguments)}function W(e){return void 0===g(e)}function X(e){return f(g(e).buffer)}function $(e){return f(new Uint8Array(g(e)))}function z(e,t,n){g(e).set(g(t),n>>>0)}function ee(e){return g(e).length}function te(e){return f(new Uint8Array(e>>>0))}function ne(e,t,n){return f(g(e).subarray(t>>>0,n>>>0))}function re(e,t){throw new Error(u(e,t))}function se(){return f(i.memory)}s()}catch(ie){s(ie)}}))},142:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.r(t),n.d(t,{default:()=>u});var s=n(942),i=n(601),o=e([s]);function _(e){const t=[];for(let n=0;n<i.JQ;++n)t.push(e.num_fish(n));const n=[],r=[],s=[];for(let t=0;t<i.Zp;++t)n.push(e.score(t)),r.push([...e.penguins(t)]),s.push([...e.claimed(t)]);return{activePlayer:e.active_player(),modeType:e.finished_drafting()?"playing":"drafting",scores:n,turn:e.turn(),board:{fish:t,penguins:r,claimed:s}}}function a(e,t){if(e.active_player()!=i.Jh)return[];if(e.finished_drafting()){if(void 0!==t)return[...e.possible_moves(t)];const n=e.active_player();return void 0===n?[]:[...e.penguins(n)]}return[...e.draftable_cells()]}s=(o.then?(await o)():o)[0];class c{constructor(e){Object.defineProperty(this,"game",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ponderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nplayouts",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.game=s.lA.new(),this.postMessage=e,this.ponder()}free(){this.stopPondering(),this.game.free()}init(){const e=this.postMessage;e({type:"state",gameState:this.getState()}),e({type:"possibleMoves",possibleMoves:this.getPossibleMoves()})}ponder(){this.nplayouts=this.game.get_visits(),void 0===this.ponderer&&(this.ponderer=self.setInterval((()=>{if(this.nplayouts>=i.BS)return void this.stopPondering();const e=performance.now();for(;performance.now()-e<i._U;)this.playout();let t=this.game.active_player();void 0!==t&&(this.game.is_drafting()?this.postPlaceScores(t):this.postMoveScores(t))}),i.c9))}stopPondering(){void 0!==this.ponderer&&(self.clearInterval(this.ponderer),this.ponderer=void 0)}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout(),++this.nplayouts}takeAction(){this.stopPondering();const e=this.postMessage,t=this.game.turn()<2?2*i.YP:i.YP;for(;this.nplayouts<t;)this.playout(),this.nplayouts%100==0&&e({type:"thinkingProgress",completed:this.nplayouts,required:t});this.game.take_action(),this.ponder()}getState(){return _(this.game)}getPossibleMoves(e){return a(this.game,e)}onMessage(e){switch(console.log(`received request ${e.type}`),e.type){case"get":this.postGameState();break;case"move":try{this.movePenguin(e.src,e.dst),this.postGameState()}catch(t){this.postIllegalMove(e.src,e.dst)}break;case"place":try{this.placePenguin(e.dst),this.postGameState()}catch(t){this.postIllegalPlacement(e.dst)}break;case"possibleMoves":this.postPossibleMoves(e.src);break;case"takeAction":this.takeAction(),this.postGameState()}}postIllegalMove(e,t){(0,this.postMessage)({type:"illegalMove",src:e,dst:t})}postIllegalPlacement(e){(0,this.postMessage)({type:"illegalPlacement",dst:e})}postPossibleMoves(e){(0,this.postMessage)({type:"possibleMoves",possibleMoves:this.getPossibleMoves(e)})}postGameState(){(0,this.postMessage)({type:"state",gameState:this.getState()})}postPlaceScores(e){const t=[];for(let e of this.game.draftable_cells()){const n=this.game.place_info(e);t.push({dst:e,visits:n.get_visits(),rewards:n.get_rewards()})}(0,this.postMessage)({type:"placeScores",activePlayer:e,placeScores:t})}postMoveScores(e){const t=[];for(let n of this.game.penguins(e))for(let e of this.game.possible_moves(n)){const r=this.game.move_info(n,e);t.push({src:n,dst:e,visits:r.get_visits(),rewards:r.get_rewards()})}(0,this.postMessage)({type:"moveScores",activePlayer:e,moveScores:t})}}const u=c;r()}catch(l){r(l)}}))},601:(e,t,n)=>{n.d(t,{BS:()=>c,JQ:()=>i,Jh:()=>s,YP:()=>a,Zp:()=>r,_U:()=>o,c9:()=>_});const r=2,s=0,i=60,o=100,_=0,a=14e3,c=6e4},335:(e,t,n)=>{n.a(e,(async(r,s)=>{try{var i,o=r([i=n(942)]),[i]=o.then?(await o)():o;await n.v(t,e.id,"dab7b7ebaa75da4e6ac3",{"./htmf_wasm_bg.js":{__wbindgen_string_new:i.h4,__wbg_new_693216e109162396:i.Ih,__wbg_stack_0ddaca5d1abfb52f:i.yq,__wbg_error_09919627ac0992f5:i.gk,__wbindgen_object_drop_ref:i.ug,__wbg_process_70251ed1291754d5:i.pk,__wbindgen_is_object:i.Wl,__wbg_versions_b23f2588cdb2ddbb:i.u,__wbg_node_61b8c9a82499895d:i.NT,__wbindgen_is_string:i.eY,__wbg_static_accessor_NODE_MODULE_33b45247c55045b0:i.wA,__wbg_require_2a93bc09fee45aca:i.qc,__wbg_crypto_2f56257a38275dbd:i.mR,__wbg_msCrypto_d07655bf62361f21:i.ZL,__wbg_getRandomValues_fb6b088efb6bead2:i.sP,__wbg_randomFillSync_654a7797990fb8db:i.mm,__wbg_newnoargs_e23b458e372830de:i.TL,__wbg_call_ae78342adc33730a:i._3,__wbindgen_object_clone_ref:i.m_,__wbg_self_99737b4dcdf6f0d8:i.OF,__wbg_window_9b61fbbf3564c4fb:i.xB,__wbg_globalThis_8e275ef40caea3a3:i.KQ,__wbg_global_5de1e0f82bddcd27:i.vm,__wbindgen_is_undefined:i.XP,__wbg_buffer_7af23f65f6c64548:i.EF,__wbg_new_cc9018bd6f283b6f:i.cb,__wbg_set_f25e869e4565d2a2:i.Ip,__wbg_length_0acb1cf9bbaf8519:i.Oo,__wbg_newwithlength_8f0657faca9f1422:i.rC,__wbg_subarray_da527dbd24eafb6b:i.YN,__wbindgen_throw:i.Or,__wbindgen_memory:i.oH}}),s()}catch(e){s(e)}}),1)}}]);