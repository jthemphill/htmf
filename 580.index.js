(()=>{"use strict";var e={942:(e,t,r)=>{r.d(t,{lA:()=>y,h4:()=>M,h9:()=>x,Dz:()=>P,kF:()=>S,ug:()=>k,E_:()=>O,L7:()=>j,MY:()=>A,f$:()=>E,sV:()=>I,_y:()=>T,Yj:()=>D,XP:()=>G,Qd:()=>q,tS:()=>U,$o:()=>$,tv:()=>C,li:()=>F,Xw:()=>V,Or:()=>X,nD:()=>Y,oH:()=>z});var n=r(45);e=r.hmd(e);let s=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});s.decode();let o=null;function i(){return null!==o&&o.buffer===n.memory.buffer||(o=new Uint8Array(n.memory.buffer)),o}function a(e,t){return s.decode(i().subarray(e,e+t))}const l=new Array(32).fill(void 0);l.push(void 0,null,!0,!1);let u=l.length;function c(e){u===l.length&&l.push(l.length+1);const t=u;return u=l[t],l[t]=e,t}function p(e){return l[e]}function _(e){const t=p(e);return function(e){e<36||(l[e]=u,u=e)}(e),t}let f=null;function g(){return null!==f&&f.buffer===n.memory.buffer||(f=new Int32Array(n.memory.buffer)),f}function d(e,t){return i().subarray(e/1,e/1+t)}let h=0,v=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const m="function"==typeof v.encodeInto?function(e,t){return v.encodeInto(e,t)}:function(e,t){const r=v.encode(e);return t.set(r),{read:e.length,written:r.length}};function b(e){return function(){try{return e.apply(this,arguments)}catch(e){n.__wbindgen_exn_store(c(e))}}}class y{static __wrap(e){const t=Object.create(y.prototype);return t.ptr=e,t}free(){const e=this.ptr;this.ptr=0,n.__wbg_game_free(e)}static new(){var e=n.game_new();return y.__wrap(e)}is_drafting(){return 0!==n.game_is_drafting(this.ptr)}finished_drafting(){return 0!==n.game_finished_drafting(this.ptr)}game_over(){return 0!==n.game_game_over(this.ptr)}active_player(){var e=n.game_active_player(this.ptr);return 16777215===e?void 0:e}score(e){return n.game_score(this.ptr,e)>>>0}turn(){return n.game_turn(this.ptr)>>>0}num_fish(e){return n.game_num_fish(this.ptr,e)>>>0}penguins(e){try{const o=n.__wbindgen_export_0.value-16;n.__wbindgen_export_0.value=o,n.game_penguins(o,this.ptr,e);var t=g()[o/4+0],r=g()[o/4+1],s=d(t,r).slice();return n.__wbindgen_free(t,1*r),s}finally{n.__wbindgen_export_0.value+=16}}claimed(e){try{const o=n.__wbindgen_export_0.value-16;n.__wbindgen_export_0.value=o,n.game_claimed(o,this.ptr,e);var t=g()[o/4+0],r=g()[o/4+1],s=d(t,r).slice();return n.__wbindgen_free(t,1*r),s}finally{n.__wbindgen_export_0.value+=16}}draftable_cells(){try{const s=n.__wbindgen_export_0.value-16;n.__wbindgen_export_0.value=s,n.game_draftable_cells(s,this.ptr);var e=g()[s/4+0],t=g()[s/4+1],r=d(e,t).slice();return n.__wbindgen_free(e,1*t),r}finally{n.__wbindgen_export_0.value+=16}}possible_moves(e){try{const o=n.__wbindgen_export_0.value-16;n.__wbindgen_export_0.value=o,n.game_possible_moves(o,this.ptr,e);var t=g()[o/4+0],r=g()[o/4+1],s=d(t,r).slice();return n.__wbindgen_free(t,1*r),s}finally{n.__wbindgen_export_0.value+=16}}place_penguin(e){n.game_place_penguin(this.ptr,e)}move_penguin(e,t){n.game_move_penguin(this.ptr,e,t)}playout(){n.game_playout(this.ptr)}place_info(e){var t=n.game_place_info(this.ptr,e);return w.__wrap(t)}move_info(e,t){var r=n.game_move_info(this.ptr,e,t);return w.__wrap(r)}take_action(){n.game_take_action(this.ptr)}}class w{static __wrap(e){const t=Object.create(w.prototype);return t.ptr=e,t}free(){const e=this.ptr;this.ptr=0,n.__wbg_moveinfo_free(e)}get_visits(){return n.moveinfo_get_visits(this.ptr)}get_rewards(){return n.moveinfo_get_rewards(this.ptr)}}const M=function(e,t){return c(a(e,t))},x=function(){return c(new Error)},P=function(e,t){var r=function(e,t,r){if(void 0===r){const r=v.encode(e),n=t(r.length);return i().subarray(n,n+r.length).set(r),h=r.length,n}let n=e.length,s=t(n);const o=i();let a=0;for(;a<n;a++){const t=e.charCodeAt(a);if(t>127)break;o[s+a]=t}if(a!==n){0!==a&&(e=e.slice(a)),s=r(s,n,n=a+3*e.length);const t=i().subarray(s+a,s+n);a+=m(e,t).written}return h=a,s}(p(t).stack,n.__wbindgen_malloc,n.__wbindgen_realloc),s=h;g()[e/4+1]=s,g()[e/4+0]=r},S=function(e,t){try{console.error(a(e,t))}finally{n.__wbindgen_free(e,t)}},k=function(e){_(e)},O=b((function(e,t){p(e).getRandomValues(p(t))})),j=b((function(e,t,r){p(e).randomFillSync(d(t,r))})),A=b((function(){return c(self.self)})),E=function(){return c(e)},I=b((function(e,t,r){return c(p(e).require(a(t,r)))})),T=function(e){return c(p(e).crypto)},D=function(e){return c(p(e).msCrypto)},G=function(e){return void 0===p(e)},q=function(e){return c(p(e).buffer)},U=function(e){return p(e).length},$=function(e){return c(new Uint8Array(p(e)))},C=function(e,t,r){p(e).set(p(t),r>>>0)},F=function(e){return c(new Uint8Array(e>>>0))},V=function(e,t,r){return c(p(e).subarray(t>>>0,r>>>0))},X=function(e,t){throw new Error(a(e,t))},Y=function(e){throw _(e)},z=function(){return c(n.memory)}},45:(e,t,r)=>{var n=r.w[e.id];e.exports=n,r(942),n[""]()}},t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={id:n,loaded:!1,exports:{}};return e[n](s,s.exports,r),s.loaded=!0,s.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=r(942);const t=self,n=new class{constructor(t){Object.defineProperty(this,"game",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ponderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nplayouts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.game=e.lA.new(),this.postMessage=t,this.nplayouts=0,this.ponder()}free(){this.stopPondering(),this.game.free()}init(){const e=this.postMessage;e({type:"state",gameState:this.getState()}),e({type:"possibleMoves",possibleMoves:this.getPossibleMoves()})}ponder(){this.nplayouts=0,void 0===this.ponderer&&(this.ponderer=self.setInterval((()=>{if(this.nplayouts>=6e4)return void this.stopPondering();const e=performance.now();for(;performance.now()-e<100;)this.playout();let t=this.game.active_player();void 0!==t&&(this.game.is_drafting()?this.postPlaceScores(t):this.postMoveScores(t))}),0))}stopPondering(){void 0!==this.ponderer&&(self.clearInterval(this.ponderer),this.ponderer=void 0)}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout(),++this.nplayouts}takeAction(){for(this.stopPondering();this.nplayouts<6e3;)this.playout();this.game.take_action(),this.ponder()}getState(){return function(e){const t=[];for(let r=0;r<60;++r)t.push(e.num_fish(r));const r=[],n=[],s=[];for(let t=0;t<2;++t)r.push(e.score(t)),n.push([...e.penguins(t)]),s.push([...e.claimed(t)]);return{activePlayer:e.active_player(),modeType:e.finished_drafting()?"playing":"drafting",scores:r,turn:e.turn(),board:{fish:t,penguins:n,claimed:s}}}(this.game)}getPossibleMoves(e){return function(e,t){if(0!=e.active_player())return[];if(e.finished_drafting()){if(void 0!==t)return[...e.possible_moves(t)];const r=e.active_player();return void 0===r?[]:[...e.penguins(r)]}return[...e.draftable_cells()]}(this.game,e)}onMessage(e){switch(console.log(`received request ${e.type}`),e.type){case"get":this.postGameState();break;case"move":try{this.movePenguin(e.src,e.dst),this.postGameState()}catch(t){this.postIllegalMove(e.src,e.dst)}break;case"place":try{this.placePenguin(e.dst),this.postGameState()}catch(t){this.postIllegalPlacement(e.dst)}break;case"possibleMoves":this.postPossibleMoves(e.src);break;case"takeAction":this.takeAction(),this.postGameState()}}postIllegalMove(e,t){(0,this.postMessage)({type:"illegalMove",src:e,dst:t})}postIllegalPlacement(e){(0,this.postMessage)({type:"illegalPlacement",dst:e})}postPossibleMoves(e){(0,this.postMessage)({type:"possibleMoves",possibleMoves:this.getPossibleMoves(e)})}postGameState(){(0,this.postMessage)({type:"state",gameState:this.getState()})}postPlaceScores(e){const t=[];for(let e of this.game.draftable_cells()){const r=this.game.place_info(e);t.push({dst:e,visits:r.get_visits(),rewards:r.get_rewards()})}(0,this.postMessage)({type:"placeScores",activePlayer:e,placeScores:t})}postMoveScores(e){const t=[];for(let r of this.game.penguins(e))for(let e of this.game.possible_moves(r)){const n=this.game.move_info(r,e);t.push({src:r,dst:e,visits:n.get_visits(),rewards:n.get_rewards()})}(0,this.postMessage)({type:"moveScores",activePlayer:e,moveScores:t})}}(t.postMessage);t.onmessage=e=>{n.onMessage(e.data)},n.init()})()})();