{"version":3,"file":"bot.worker-BqT4TGuF.js","sources":["../../wasm/pkg/htmf_wasm.js","../src/browser/constants.ts","../src/webworker/Bot.ts","../src/webworker/bot.worker.ts"],"sourcesContent":["let wasm;\n\nlet cachedUint8ArrayMemory0 = null;\n\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.byteLength === 0) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nlet cachedTextDecoder = new TextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n\ncachedTextDecoder.decode();\n\nconst MAX_SAFARI_DECODE_BYTES = 2146435072;\nlet numBytesDecoded = 0;\nfunction decodeText(ptr, len) {\n    numBytesDecoded += len;\n    if (numBytesDecoded >= MAX_SAFARI_DECODE_BYTES) {\n        cachedTextDecoder = new TextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n        cachedTextDecoder.decode();\n        numBytesDecoded = len;\n    }\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().subarray(ptr, ptr + len));\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return decodeText(ptr, len);\n}\n\nfunction addToExternrefTable0(obj) {\n    const idx = wasm.__externref_table_alloc();\n    wasm.__wbindgen_export_3.set(idx, obj);\n    return idx;\n}\n\nfunction handleError(f, args) {\n    try {\n        return f.apply(this, args);\n    } catch (e) {\n        const idx = addToExternrefTable0(e);\n        wasm.__wbindgen_exn_store(idx);\n    }\n}\n\nfunction getArrayU8FromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return getUint8ArrayMemory0().subarray(ptr / 1, ptr / 1 + len);\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nconst cachedTextEncoder = new TextEncoder();\n\nif (!('encodeInto' in cachedTextEncoder)) {\n    cachedTextEncoder.encodeInto = function (arg, view) {\n        const buf = cachedTextEncoder.encode(arg);\n        view.set(buf);\n        return {\n            read: arg.length,\n            written: buf.length\n        };\n    }\n}\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n\n    const mem = getUint8ArrayMemory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = cachedTextEncoder.encodeInto(arg, view);\n\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nlet cachedDataViewMemory0 = null;\n\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer.detached === true || (cachedDataViewMemory0.buffer.detached === undefined && cachedDataViewMemory0.buffer !== wasm.memory.buffer)) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\n/**\n * This function only exists when you compile without multithreading support!\n *\n * This function does nothing; it's just a stub function to match\n * `wasm_bindgen_rayon::init_thread_pool`, which exists when you do compile with\n * multithreading support.\n * @param {number} _num_threads\n * @returns {Promise<any>}\n */\nexport function initThreadPool(_num_threads) {\n    const ret = wasm.initThreadPool(_num_threads);\n    return ret;\n}\n\nfunction takeFromExternrefTable0(idx) {\n    const value = wasm.__wbindgen_export_3.get(idx);\n    wasm.__externref_table_dealloc(idx);\n    return value;\n}\n\nconst GameFinalization = (typeof FinalizationRegistry === 'undefined')\n    ? { register: () => {}, unregister: () => {} }\n    : new FinalizationRegistry(ptr => wasm.__wbg_game_free(ptr >>> 0, 1));\n\nexport class Game {\n\n    static __wrap(ptr) {\n        ptr = ptr >>> 0;\n        const obj = Object.create(Game.prototype);\n        obj.__wbg_ptr = ptr;\n        GameFinalization.register(obj, obj.__wbg_ptr, obj);\n        return obj;\n    }\n\n    __destroy_into_raw() {\n        const ptr = this.__wbg_ptr;\n        this.__wbg_ptr = 0;\n        GameFinalization.unregister(this);\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_game_free(ptr, 0);\n    }\n    /**\n     * @returns {number}\n     */\n    get_visits() {\n        const ret = wasm.game_get_visits(this.__wbg_ptr);\n        return ret;\n    }\n    /**\n     *\n     *     * Number of times we've tried and won by placing a penguin at `dst` on the current board\n     *\n     * @param {number} dst\n     * @returns {MoveInfo}\n     */\n    place_info(dst) {\n        const ret = wasm.game_place_info(this.__wbg_ptr, dst);\n        return MoveInfo.__wrap(ret);\n    }\n    /**\n     * @returns {boolean}\n     */\n    is_drafting() {\n        const ret = wasm.game_is_drafting(this.__wbg_ptr);\n        return ret !== 0;\n    }\n    take_action() {\n        const ret = wasm.game_take_action(this.__wbg_ptr);\n        if (ret[1]) {\n            throw takeFromExternrefTable0(ret[0]);\n        }\n    }\n    /**\n     * @param {number} src\n     * @param {number} dst\n     */\n    move_penguin(src, dst) {\n        const ret = wasm.game_move_penguin(this.__wbg_ptr, src, dst);\n        if (ret[1]) {\n            throw takeFromExternrefTable0(ret[0]);\n        }\n    }\n    /**\n     * @returns {number | undefined}\n     */\n    active_player() {\n        const ret = wasm.game_active_player(this.__wbg_ptr);\n        return ret === 0xFFFFFF ? undefined : ret;\n    }\n    /**\n     * @param {number} dst\n     */\n    place_penguin(dst) {\n        const ret = wasm.game_place_penguin(this.__wbg_ptr, dst);\n        if (ret[1]) {\n            throw takeFromExternrefTable0(ret[0]);\n        }\n    }\n    /**\n     * @param {number} src\n     * @returns {Uint8Array}\n     */\n    possible_moves(src) {\n        const ret = wasm.game_possible_moves(this.__wbg_ptr, src);\n        var v1 = getArrayU8FromWasm0(ret[0], ret[1]).slice();\n        wasm.__wbindgen_free(ret[0], ret[1] * 1, 1);\n        return v1;\n    }\n    /**\n     * @returns {Uint8Array}\n     */\n    draftable_cells() {\n        const ret = wasm.game_draftable_cells(this.__wbg_ptr);\n        var v1 = getArrayU8FromWasm0(ret[0], ret[1]).slice();\n        wasm.__wbindgen_free(ret[0], ret[1] * 1, 1);\n        return v1;\n    }\n    /**\n     * @param {number} n\n     */\n    playout_n_times(n) {\n        wasm.game_playout_n_times(this.__wbg_ptr, n);\n    }\n    /**\n     * @returns {boolean}\n     */\n    finished_drafting() {\n        const ret = wasm.game_finished_drafting(this.__wbg_ptr);\n        return ret !== 0;\n    }\n    /**\n     * @returns {number}\n     */\n    get_total_playouts() {\n        const ret = wasm.game_get_total_playouts(this.__wbg_ptr);\n        return ret >>> 0;\n    }\n    /**\n     * @returns {Game}\n     */\n    static new() {\n        const ret = wasm.game_new();\n        return Game.__wrap(ret);\n    }\n    /**\n     * @returns {number}\n     */\n    turn() {\n        const ret = wasm.game_turn(this.__wbg_ptr);\n        return ret >>> 0;\n    }\n    /**\n     * @param {number} player\n     * @returns {number}\n     */\n    score(player) {\n        const ret = wasm.game_score(this.__wbg_ptr, player);\n        return ret >>> 0;\n    }\n    /**\n     * @param {number} player\n     * @returns {Uint8Array}\n     */\n    claimed(player) {\n        const ret = wasm.game_claimed(this.__wbg_ptr, player);\n        var v1 = getArrayU8FromWasm0(ret[0], ret[1]).slice();\n        wasm.__wbindgen_free(ret[0], ret[1] * 1, 1);\n        return v1;\n    }\n    playout() {\n        wasm.game_playout(this.__wbg_ptr);\n    }\n    /**\n     * @param {number} idx\n     * @returns {number}\n     */\n    num_fish(idx) {\n        const ret = wasm.game_num_fish(this.__wbg_ptr, idx);\n        return ret >>> 0;\n    }\n    /**\n     * @param {number} player\n     * @returns {Uint8Array}\n     */\n    penguins(player) {\n        const ret = wasm.game_penguins(this.__wbg_ptr, player);\n        var v1 = getArrayU8FromWasm0(ret[0], ret[1]).slice();\n        wasm.__wbindgen_free(ret[0], ret[1] * 1, 1);\n        return v1;\n    }\n    /**\n     * @returns {boolean}\n     */\n    game_over() {\n        const ret = wasm.game_game_over(this.__wbg_ptr);\n        return ret !== 0;\n    }\n    /**\n     *\n     *     * Number of times we've tried and won by moving a penguin from `src` to `dst` on the current\n     *     * board\n     *\n     * @param {number} src\n     * @param {number} dst\n     * @returns {MoveInfo}\n     */\n    move_info(src, dst) {\n        const ret = wasm.game_move_info(this.__wbg_ptr, src, dst);\n        return MoveInfo.__wrap(ret);\n    }\n    /**\n     * @returns {number}\n     */\n    tree_size() {\n        const ret = wasm.game_tree_size(this.__wbg_ptr);\n        return ret >>> 0;\n    }\n}\nif (Symbol.dispose) Game.prototype[Symbol.dispose] = Game.prototype.free;\n\nconst MoveInfoFinalization = (typeof FinalizationRegistry === 'undefined')\n    ? { register: () => {}, unregister: () => {} }\n    : new FinalizationRegistry(ptr => wasm.__wbg_moveinfo_free(ptr >>> 0, 1));\n\nexport class MoveInfo {\n\n    static __wrap(ptr) {\n        ptr = ptr >>> 0;\n        const obj = Object.create(MoveInfo.prototype);\n        obj.__wbg_ptr = ptr;\n        MoveInfoFinalization.register(obj, obj.__wbg_ptr, obj);\n        return obj;\n    }\n\n    __destroy_into_raw() {\n        const ptr = this.__wbg_ptr;\n        this.__wbg_ptr = 0;\n        MoveInfoFinalization.unregister(this);\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_moveinfo_free(ptr, 0);\n    }\n    /**\n     * @returns {number}\n     */\n    get_visits() {\n        const ret = wasm.moveinfo_get_visits(this.__wbg_ptr);\n        return ret;\n    }\n    /**\n     * @returns {number}\n     */\n    get_rewards() {\n        const ret = wasm.moveinfo_get_rewards(this.__wbg_ptr);\n        return ret;\n    }\n}\nif (Symbol.dispose) MoveInfo.prototype[Symbol.dispose] = MoveInfo.prototype.free;\n\nconst EXPECTED_RESPONSE_TYPES = new Set(['basic', 'cors', 'default']);\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                const validResponse = module.ok && EXPECTED_RESPONSE_TYPES.has(module.type);\n\n                if (validResponse && module.headers.get('Content-Type') !== 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nfunction __wbg_get_imports() {\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbg_error_7534b8e9a36f1ab4 = function(arg0, arg1) {\n        let deferred0_0;\n        let deferred0_1;\n        try {\n            deferred0_0 = arg0;\n            deferred0_1 = arg1;\n            console.error(getStringFromWasm0(arg0, arg1));\n        } finally {\n            wasm.__wbindgen_free(deferred0_0, deferred0_1, 1);\n        }\n    };\n    imports.wbg.__wbg_getRandomValues_80578b2ff2a093ba = function() { return handleError(function (arg0) {\n        globalThis.crypto.getRandomValues(arg0);\n    }, arguments) };\n    imports.wbg.__wbg_length_6bb7e81f9d7713e4 = function(arg0) {\n        const ret = arg0.length;\n        return ret;\n    };\n    imports.wbg.__wbg_new_8a6f238a6ece86ea = function() {\n        const ret = new Error();\n        return ret;\n    };\n    imports.wbg.__wbg_newwithlength_a167dcc7aaa3ba77 = function(arg0) {\n        const ret = new Uint8Array(arg0 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_prototypesetcall_3d4a26c1ed734349 = function(arg0, arg1, arg2) {\n        Uint8Array.prototype.set.call(getArrayU8FromWasm0(arg0, arg1), arg2);\n    };\n    imports.wbg.__wbg_resolve_4055c623acdd6a1b = function(arg0) {\n        const ret = Promise.resolve(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_stack_0ed75d68575b0f3c = function(arg0, arg1) {\n        const ret = arg1.stack;\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_subarray_70fd07feefe14294 = function(arg0, arg1, arg2) {\n        const ret = arg0.subarray(arg1 >>> 0, arg2 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_wbindgenthrow_451ec1a8469d7eb6 = function(arg0, arg1) {\n        throw new Error(getStringFromWasm0(arg0, arg1));\n    };\n    imports.wbg.__wbindgen_cast_2241b6af4c4b2941 = function(arg0, arg1) {\n        // Cast intrinsic for `Ref(String) -> Externref`.\n        const ret = getStringFromWasm0(arg0, arg1);\n        return ret;\n    };\n    imports.wbg.__wbindgen_init_externref_table = function() {\n        const table = wasm.__wbindgen_export_3;\n        const offset = table.grow(4);\n        table.set(0, undefined);\n        table.set(offset + 0, undefined);\n        table.set(offset + 1, null);\n        table.set(offset + 2, true);\n        table.set(offset + 3, false);\n        ;\n    };\n\n    return imports;\n}\n\nfunction __wbg_init_memory(imports, memory) {\n\n}\n\nfunction __wbg_finalize_init(instance, module) {\n    wasm = instance.exports;\n    __wbg_init.__wbindgen_wasm_module = module;\n    cachedDataViewMemory0 = null;\n    cachedUint8ArrayMemory0 = null;\n\n\n    wasm.__wbindgen_start();\n    return wasm;\n}\n\nfunction initSync(module) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module !== 'undefined') {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n\n    __wbg_init_memory(imports);\n\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n\n    const instance = new WebAssembly.Instance(module, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nasync function __wbg_init(module_or_path) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module_or_path !== 'undefined') {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (typeof module_or_path === 'undefined') {\n        module_or_path = new URL('htmf_wasm_bg.wasm', import.meta.url);\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    __wbg_init_memory(imports);\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nexport { initSync };\nexport default __wbg_init;\n","export const NPLAYERS = 2;\nexport const HUMAN_PLAYER = 0;\nexport const BOT_PLAYER = 1;\nexport const NUM_ROWS = 8;\nexport const EVEN_ROW_LEN = 7;\nexport const ODD_ROW_LEN = 8;\nexport const NUM_CELLS: number =\n  EVEN_ROW_LEN * (NUM_ROWS / 2) + ODD_ROW_LEN * (NUM_ROWS / 2);\n\nexport const PLAYOUT_CHUNK_SIZE = 200;\nexport const MIN_PLAYOUTS = 14_000;\nexport const MAX_PLAYOUTS = 60_000;\n","import * as wasm from \"htmf-wasm\";\n\nimport {\n  NPLAYERS,\n  NUM_CELLS,\n  MIN_PLAYOUTS,\n  MAX_PLAYOUTS,\n  HUMAN_PLAYER,\n  BOT_PLAYER,\n  PLAYOUT_CHUNK_SIZE,\n} from \"../browser/constants\";\nimport {\n  type GameState,\n  type MoveScore,\n  type WorkerRequest,\n  type WorkerResponse,\n} from \"../browser/WorkerProtocol\";\n\nfunction getGameState(game: wasm.Game): GameState {\n  const fish = [];\n  for (let idx = 0; idx < NUM_CELLS; ++idx) {\n    fish.push(game.num_fish(idx));\n  }\n  const scores: number[] = [];\n  const penguins = [];\n  const claimed = [];\n  for (let p = 0; p < NPLAYERS; ++p) {\n    scores.push(game.score(p));\n    penguins.push([...game.penguins(p)]);\n    claimed.push([...game.claimed(p)]);\n  }\n  return {\n    activePlayer: game.active_player(),\n    modeType: game.finished_drafting() ? \"playing\" : \"drafting\",\n    scores,\n    turn: game.turn(),\n    board: {\n      fish,\n      penguins,\n      claimed,\n    },\n  };\n}\n\nfunction getPossibleMoves(game: wasm.Game, src?: number): number[] {\n  if (game.active_player() !== HUMAN_PLAYER) {\n    return [];\n  }\n  if (game.finished_drafting()) {\n    if (src !== undefined) {\n      return [...game.possible_moves(src)];\n    }\n    const activePlayer = game.active_player();\n    return activePlayer === undefined ? [] : [...game.penguins(activePlayer)];\n  } else {\n    return [...game.draftable_cells()];\n  }\n}\n\nclass Bot {\n  wasmInternals: wasm.InitOutput;\n  game: wasm.Game = wasm.Game.new();\n  postMessage: (msg: WorkerResponse) => void;\n  ponderer?: number;\n  ponderStartTime?: number;\n  totalCompletedPonderTimeMs = 0;\n\n  constructor(\n    wasmInternals: wasm.InitOutput,\n    postMessage: (msg: WorkerResponse) => void,\n  ) {\n    this.wasmInternals = wasmInternals;\n    this.postMessage = postMessage;\n    this.ponder();\n    this.postGameState({});\n  }\n\n  free(): void {\n    this.stopPondering();\n    this.game.free();\n    this.totalCompletedPonderTimeMs = 0;\n  }\n\n  ponder(): void {\n    if (this.ponderer !== undefined) {\n      return;\n    }\n    this.ponderStartTime = performance.now();\n    this.ponderer = self.setInterval(() => {\n      const activePlayer = this.game.active_player();\n      if (\n        this.game.get_visits() >= MAX_PLAYOUTS ||\n        activePlayer === BOT_PLAYER\n      ) {\n        this.stopPondering();\n        return;\n      }\n\n      this.game.playout_n_times(PLAYOUT_CHUNK_SIZE);\n\n      if (activePlayer !== undefined) {\n        this.postThinkingProgress({\n          activePlayer,\n          playoutsNeeded: MAX_PLAYOUTS,\n        });\n      }\n    });\n  }\n\n  stopPondering(): void {\n    if (this.ponderer !== undefined) {\n      clearInterval(this.ponderer);\n      this.ponderer = undefined;\n    }\n    if (this.ponderStartTime !== undefined) {\n      this.totalCompletedPonderTimeMs +=\n        performance.now() - this.ponderStartTime;\n      this.ponderStartTime = undefined;\n    }\n  }\n\n  placePenguin(dst: number): void {\n    this.game.place_penguin(dst);\n    this.ponder();\n  }\n\n  movePenguin(src: number, dst: number): void {\n    this.game.move_penguin(src, dst);\n    this.ponder();\n  }\n\n  playout(): void {\n    this.game.playout();\n  }\n\n  takeAction(): void {\n    const playoutsNeeded =\n      this.game.turn() < 2 ? 2 * MIN_PLAYOUTS : MIN_PLAYOUTS;\n    let lastIntervalTime = performance.now();\n    while (this.game.get_visits() < playoutsNeeded) {\n      this.game.playout_n_times(PLAYOUT_CHUNK_SIZE);\n      this.totalCompletedPonderTimeMs += performance.now() - lastIntervalTime;\n      lastIntervalTime = performance.now();\n\n      const activePlayer = this.game.active_player();\n      if (activePlayer !== undefined) {\n        this.postThinkingProgress({ activePlayer, playoutsNeeded });\n      }\n    }\n    this.totalCompletedPonderTimeMs += performance.now() - lastIntervalTime;\n    lastIntervalTime = performance.now();\n\n    this.game.take_action();\n    this.postGameState({});\n    this.ponder();\n  }\n\n  getState(): GameState {\n    return getGameState(this.game);\n  }\n\n  getPossibleMoves(src?: number): number[] {\n    return getPossibleMoves(this.game, src);\n  }\n\n  onMessage(request: WorkerRequest): void {\n    console.log(`received request ${request.type}`);\n    let src;\n    let lastMoveWasIllegal = false;\n    switch (request.type) {\n      case \"getGameState\":\n        break;\n      case \"movePenguin\":\n        try {\n          if (request.src === undefined) {\n            this.placePenguin(request.dst);\n          } else {\n            this.movePenguin(request.src, request.dst);\n          }\n        } catch (err) {\n          void err;\n          lastMoveWasIllegal = true;\n        }\n        break;\n      case \"getPossibleMoves\":\n        src = request.src;\n        break;\n    }\n    this.postGameState({ src, lastMoveWasIllegal });\n    while (this.game.active_player() === BOT_PLAYER) {\n      this.takeAction();\n    }\n  }\n\n  postGameState({\n    src,\n    lastMoveWasIllegal,\n  }: {\n    src?: number;\n    lastMoveWasIllegal?: boolean;\n  }): void {\n    lastMoveWasIllegal = lastMoveWasIllegal === true;\n    const postMessage = this.postMessage;\n    postMessage({\n      type: \"gameState\",\n      gameState: this.getState(),\n      possibleMoves: this.getPossibleMoves(src),\n      lastMoveWasIllegal,\n    });\n  }\n\n  postThinkingProgress({\n    activePlayer,\n    playoutsNeeded,\n  }: {\n    activePlayer: number;\n    playoutsNeeded: number;\n  }): void {\n    const postMessage = this.postMessage;\n    postMessage({\n      type: \"thinkingProgress\",\n      completed: this.game.get_visits(),\n      required: playoutsNeeded,\n      totalPlayouts: this.game.get_total_playouts(),\n      totalTimeThinkingMs: this.getTotalTimeThinkingMs(),\n      memoryUsage: this.wasmInternals.memory.buffer.byteLength,\n      treeSize: this.game.tree_size(),\n      playerMoveScores: {\n        player: activePlayer,\n        moveScores: this.getMoveScores(activePlayer),\n      },\n    });\n  }\n\n  getMoveScores(activePlayer: number): MoveScore[] {\n    const moveScores: MoveScore[] = [];\n    if (this.game.is_drafting()) {\n      for (const dst of this.game.draftable_cells()) {\n        const info = this.game.place_info(dst);\n        moveScores.push({\n          dst,\n          visits: info.get_visits(),\n          rewards: info.get_rewards(),\n        });\n      }\n    } else {\n      for (const src of this.game.penguins(activePlayer)) {\n        for (const dst of this.game.possible_moves(src)) {\n          const info = this.game.move_info(src, dst);\n          moveScores.push({\n            src,\n            dst,\n            visits: info.get_visits(),\n            rewards: info.get_rewards(),\n          });\n        }\n      }\n    }\n    return moveScores;\n  }\n\n  getTotalTimeThinkingMs(): number {\n    let totalTimeThinkingMs = this.totalCompletedPonderTimeMs;\n    if (this.ponderStartTime !== undefined) {\n      totalTimeThinkingMs += performance.now() - this.ponderStartTime;\n    }\n    return totalTimeThinkingMs;\n  }\n}\n\nexport default Bot;\n","import Bot from \"./Bot\";\nimport htmfWasmInit, * as htmfWasm from \"htmf-wasm\";\nimport type { WorkerRequest } from \"../browser/WorkerProtocol\";\n\n// Run WebAssembly.instantiateStreaming() to load and initialize the WebAssembly module\nconst memory = new WebAssembly.Memory({\n  initial: 18,\n  maximum: 16384,\n  shared: true,\n});\nconst wasmInternals = await htmfWasmInit({ memory });\n\n// Initialize a pool with one WebWorker per available core\nawait htmfWasm.initThreadPool(navigator.hardwareConcurrency);\n\nconst bot = new Bot(wasmInternals, postMessage);\nonmessage = (event: MessageEvent<WorkerRequest>) => {\n  bot.onMessage(event.data);\n};\n\nexport {};\n"],"names":["wasm","cachedUint8ArrayMemory0","getUint8ArrayMemory0","cachedTextDecoder","MAX_SAFARI_DECODE_BYTES","numBytesDecoded","decodeText","ptr","len","getStringFromWasm0","addToExternrefTable0","obj","idx","handleError","f","args","e","getArrayU8FromWasm0","WASM_VECTOR_LEN","cachedTextEncoder","arg","view","buf","passStringToWasm0","malloc","realloc","mem","offset","code","ret","cachedDataViewMemory0","getDataViewMemory0","initThreadPool","_num_threads","takeFromExternrefTable0","value","GameFinalization","Game","dst","MoveInfo","src","v1","n","player","MoveInfoFinalization","EXPECTED_RESPONSE_TYPES","__wbg_load","module","imports","bytes","instance","__wbg_get_imports","arg0","arg1","deferred0_0","deferred0_1","arg2","ptr1","len1","table","__wbg_finalize_init","__wbg_init","module_or_path","NPLAYERS","HUMAN_PLAYER","BOT_PLAYER","NUM_ROWS","EVEN_ROW_LEN","ODD_ROW_LEN","NUM_CELLS","PLAYOUT_CHUNK_SIZE","MIN_PLAYOUTS","MAX_PLAYOUTS","getGameState","game","fish","scores","penguins","claimed","p","getPossibleMoves","activePlayer","Bot","wasm.Game","wasmInternals","postMessage","playoutsNeeded","lastIntervalTime","request","lastMoveWasIllegal","moveScores","info","totalTimeThinkingMs","memory","htmfWasmInit","htmfWasm.initThreadPool","bot","event"],"mappings":"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"}