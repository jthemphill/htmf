let i;function f(n){const e=i.__externref_table_alloc();return i.__wbindgen_export_2.set(e,n),e}function g(n,e){try{return n.apply(this,e)}catch(t){const r=f(t);i.__wbindgen_exn_store(r)}}const F=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&F.decode();let u=null;function l(){return(u===null||u.buffer!==i.memory.buffer)&&(u=new Uint8Array(i.memory.buffer)),u}function w(n,e){return n=n>>>0,F.decode(l().slice(n,n+e))}let v=0;const R=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},O=function(n,e){const t=R.encode(n);return e.set(t),{read:n.length,written:t.length}};function U(n,e,t){if(t===void 0){const a=R.encode(n),c=e(a.length,1)>>>0;return l().subarray(c,c+a.length).set(a),v=a.length,c}let r=n.length,s=e(r,1)>>>0;const o=l();let _=0;for(;_<r;_++){const a=n.charCodeAt(_);if(a>127)break;o[s+_]=a}if(_!==r){_!==0&&(n=n.slice(_)),s=t(s,r,r=_+n.length*3,1)>>>0;const a=l().subarray(s+_,s+r),c=O(n,a);_+=c.written,s=t(s,r,_,1)>>>0}return v=_,s}let b=null;function T(){return(b===null||b.buffer!==i.memory.buffer)&&(b=new DataView(i.memory.buffer)),b}function d(n){return n==null}function W(n){return i.initThreadPool(n)}function p(n,e){return n=n>>>0,l().subarray(n/1,n/1+e)}function y(n){const e=i.__wbindgen_export_2.get(n);return i.__externref_table_dealloc(n),e}const M=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>i.__wbg_game_free(n>>>0,1));class m{static __wrap(e){e=e>>>0;const t=Object.create(m.prototype);return t.__wbg_ptr=e,M.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,M.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_game_free(e,0)}static new(){const e=i.game_new();return m.__wrap(e)}is_drafting(){return i.game_is_drafting(this.__wbg_ptr)!==0}finished_drafting(){return i.game_finished_drafting(this.__wbg_ptr)!==0}game_over(){return i.game_game_over(this.__wbg_ptr)!==0}active_player(){const e=i.game_active_player(this.__wbg_ptr);return e===16777215?void 0:e}score(e){return i.game_score(this.__wbg_ptr,e)>>>0}turn(){return i.game_turn(this.__wbg_ptr)>>>0}num_fish(e){return i.game_num_fish(this.__wbg_ptr,e)>>>0}penguins(e){const t=i.game_penguins(this.__wbg_ptr,e);var r=p(t[0],t[1]).slice();return i.__wbindgen_free(t[0],t[1]*1,1),r}claimed(e){const t=i.game_claimed(this.__wbg_ptr,e);var r=p(t[0],t[1]).slice();return i.__wbindgen_free(t[0],t[1]*1,1),r}draftable_cells(){const e=i.game_draftable_cells(this.__wbg_ptr);var t=p(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}possible_moves(e){const t=i.game_possible_moves(this.__wbg_ptr,e);var r=p(t[0],t[1]).slice();return i.__wbindgen_free(t[0],t[1]*1,1),r}place_penguin(e){const t=i.game_place_penguin(this.__wbg_ptr,e);if(t[1])throw y(t[0])}move_penguin(e,t){const r=i.game_move_penguin(this.__wbg_ptr,e,t);if(r[1])throw y(r[0])}playout(){i.game_playout(this.__wbg_ptr)}playout_n_times(e){i.game_playout_n_times(this.__wbg_ptr,e)}get_total_playouts(){return i.game_get_total_playouts(this.__wbg_ptr)>>>0}get_visits(){return i.game_get_visits(this.__wbg_ptr)}place_info(e){const t=i.game_place_info(this.__wbg_ptr,e);return h.__wrap(t)}move_info(e,t){const r=i.game_move_info(this.__wbg_ptr,e,t);return h.__wrap(r)}take_action(){const e=i.game_take_action(this.__wbg_ptr);if(e[1])throw y(e[0])}tree_size(){return i.game_tree_size(this.__wbg_ptr)>>>0}}const S=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>i.__wbg_moveinfo_free(n>>>0,1));class h{static __wrap(e){e=e>>>0;const t=Object.create(h.prototype);return t.__wbg_ptr=e,S.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,S.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_moveinfo_free(e,0)}get_visits(){return i.moveinfo_get_visits(this.__wbg_ptr)}get_rewards(){return i.moveinfo_get_rewards(this.__wbg_ptr)}}async function I(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function C(){const n={};return n.wbg={},n.wbg.__wbg_buffer_61b7ce01341d7f88=function(e){return e.buffer},n.wbg.__wbg_call_500db948e69c7330=function(){return g(function(e,t,r){return e.call(t,r)},arguments)},n.wbg.__wbg_call_b0d8e36992d9900d=function(){return g(function(e,t){return e.call(t)},arguments)},n.wbg.__wbg_crypto_ed58b8e10a292839=function(e){return e.crypto},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,s;try{r=e,s=t,console.error(w(e,t))}finally{i.__wbindgen_free(r,s,1)}},n.wbg.__wbg_getRandomValues_bcb4912f16000dc4=function(){return g(function(e,t){e.getRandomValues(t)},arguments)},n.wbg.__wbg_msCrypto_0a36e2ec3a343d26=function(e){return e.msCrypto},n.wbg.__wbg_new_3ff5b33b1ce712df=function(e){return new Uint8Array(e)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_newnoargs_fd9e4bf8be2bc16d=function(e,t){return new Function(w(e,t))},n.wbg.__wbg_newwithbyteoffsetandlength_ba35896968751d91=function(e,t,r){return new Uint8Array(e,t>>>0,r>>>0)},n.wbg.__wbg_newwithlength_34ce8f1051e74449=function(e){return new Uint8Array(e>>>0)},n.wbg.__wbg_node_02999533c4ea02e3=function(e){return e.node},n.wbg.__wbg_process_5c1d670bc53614b8=function(e){return e.process},n.wbg.__wbg_randomFillSync_ab2cfe79ebbf2740=function(){return g(function(e,t){e.randomFillSync(t)},arguments)},n.wbg.__wbg_require_79b1e9274cde3c87=function(){return g(function(){return module.require},arguments)},n.wbg.__wbg_resolve_0bf7c44d641804f9=function(e){return Promise.resolve(e)},n.wbg.__wbg_set_23d69db4e5c66a6e=function(e,t,r){e.set(t,r>>>0)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const r=t.stack,s=U(r,i.__wbindgen_malloc,i.__wbindgen_realloc),o=v;T().setInt32(e+4*1,o,!0),T().setInt32(e+4*0,s,!0)},n.wbg.__wbg_static_accessor_GLOBAL_0be7472e492ad3e3=function(){const e=typeof global>"u"?null:global;return d(e)?0:f(e)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_1a6eb482d12c9bfb=function(){const e=typeof globalThis>"u"?null:globalThis;return d(e)?0:f(e)},n.wbg.__wbg_static_accessor_SELF_1dc398a895c82351=function(){const e=typeof self>"u"?null:self;return d(e)?0:f(e)},n.wbg.__wbg_static_accessor_WINDOW_ae1c80c7eea8d64a=function(){const e=typeof window>"u"?null:window;return d(e)?0:f(e)},n.wbg.__wbg_subarray_46adeb9b86949d12=function(e,t,r){return e.subarray(t>>>0,r>>>0)},n.wbg.__wbg_versions_c71aa1626a93e0a1=function(e){return e.versions},n.wbg.__wbindgen_init_externref_table=function(){const e=i.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},n.wbg.__wbindgen_is_object=function(e){const t=e;return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_string=function(e){return typeof e=="string"},n.wbg.__wbindgen_is_undefined=function(e){return e===void 0},n.wbg.__wbindgen_memory=function(){return i.memory},n.wbg.__wbindgen_string_new=function(e,t){return w(e,t)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(w(e,t))},n}function N(n,e){n.wbg.memory=e||new WebAssembly.Memory({initial:18,maximum:16384,shared:!0})}function D(n,e,t){if(i=n.exports,k.__wbindgen_wasm_module=e,b=null,u=null,typeof t<"u"&&(typeof t!="number"||t===0||t%65536!==0))throw"invalid stack size";return i.__wbindgen_start(t),i}async function k(n,e){if(i!==void 0)return i;let t;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n,memory:e,thread_stack_size:t}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL(""+new URL("htmf_wasm_bg-iqDKnBov.wasm",import.meta.url).href,import.meta.url));const r=C();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n)),N(r,e);const{instance:s,module:o}=await I(await n,r);return D(s,o,t)}const z=2,j=0,P=1,A=8,G=7,B=8,V=G*(A/2)+B*(A/2),x=200,E=14e3,L=6e4;function Y(n){const e=[];for(let o=0;o<V;++o)e.push(n.num_fish(o));const t=[],r=[],s=[];for(let o=0;o<z;++o)t.push(n.score(o)),r.push([...n.penguins(o)]),s.push([...n.claimed(o)]);return{activePlayer:n.active_player(),modeType:n.finished_drafting()?"playing":"drafting",scores:t,turn:n.turn(),board:{fish:e,penguins:r,claimed:s}}}function H(n,e){if(n.active_player()!==j)return[];if(n.finished_drafting()){if(e!==void 0)return[...n.possible_moves(e)];const t=n.active_player();return t===void 0?[]:[...n.penguins(t)]}else return[...n.draftable_cells()]}class K{wasmInternals;game=m.new();postMessage;ponderer;ponderStartTime;totalCompletedPonderTimeMs=0;constructor(e,t){this.wasmInternals=e,this.postMessage=t,this.ponder(),this.postGameState({})}free(){this.stopPondering(),this.game.free(),this.totalCompletedPonderTimeMs=0}ponder(){this.ponderer===void 0&&(this.ponderStartTime=performance.now(),this.ponderer=self.setInterval(()=>{const e=this.game.active_player();if(this.game.get_visits()>=L||e===P){this.stopPondering();return}this.game.playout_n_times(x),e!==void 0&&this.postThinkingProgress({activePlayer:e,playoutsNeeded:L})}))}stopPondering(){this.ponderer!==void 0&&(clearInterval(this.ponderer),this.ponderer=void 0),this.ponderStartTime!==void 0&&(this.totalCompletedPonderTimeMs+=performance.now()-this.ponderStartTime,this.ponderStartTime=void 0)}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout()}takeAction(){const e=this.game.turn()<2?2*E:E;let t=performance.now();for(;this.game.get_visits()<e;){this.game.playout_n_times(x),this.totalCompletedPonderTimeMs+=performance.now()-t,t=performance.now();const r=this.game.active_player();r!==void 0&&this.postThinkingProgress({activePlayer:r,playoutsNeeded:e})}this.totalCompletedPonderTimeMs+=performance.now()-t,t=performance.now(),this.game.take_action(),this.postGameState({}),this.ponder()}getState(){return Y(this.game)}getPossibleMoves(e){return H(this.game,e)}onMessage(e){console.log(`received request ${e.type}`);let t,r=!1;switch(e.type){case"getGameState":break;case"movePenguin":try{e.src===void 0?this.placePenguin(e.dst):this.movePenguin(e.src,e.dst)}catch{r=!0}break;case"getPossibleMoves":t=e.src;break}for(this.postGameState({src:t,lastMoveWasIllegal:r});this.game.active_player()===P;)this.takeAction()}postGameState({src:e,lastMoveWasIllegal:t}){t=t===!0;const r=this.postMessage;r({type:"gameState",gameState:this.getState(),possibleMoves:this.getPossibleMoves(e),lastMoveWasIllegal:t})}postThinkingProgress({activePlayer:e,playoutsNeeded:t}){const r=this.postMessage;r({type:"thinkingProgress",completed:this.game.get_visits(),required:t,totalPlayouts:this.game.get_total_playouts(),totalTimeThinkingMs:this.getTotalTimeThinkingMs(),memoryUsage:this.wasmInternals.memory.buffer.byteLength,treeSize:this.game.tree_size(),playerMoveScores:{player:e,moveScores:this.getMoveScores(e)}})}getMoveScores(e){const t=[];if(this.game.is_drafting())for(const r of this.game.draftable_cells()){const s=this.game.place_info(r);t.push({dst:r,visits:s.get_visits(),rewards:s.get_rewards()})}else for(const r of this.game.penguins(e))for(const s of this.game.possible_moves(r)){const o=this.game.move_info(r,s);t.push({src:r,dst:s,visits:o.get_visits(),rewards:o.get_rewards()})}return t}getTotalTimeThinkingMs(){let e=this.totalCompletedPonderTimeMs;return this.ponderStartTime!==void 0&&(e+=performance.now()-this.ponderStartTime),e}}const q=new WebAssembly.Memory({initial:18,maximum:16384,shared:!0}),X=await k({memory:q});await W(navigator.hardwareConcurrency);const Z=new K(X,postMessage);onmessage=n=>{Z.onMessage(n.data)};
//# sourceMappingURL=bot.worker-Ba8KKb5J.js.map
