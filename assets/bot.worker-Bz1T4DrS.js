let s,l=null;function d(){return(l===null||l.byteLength===0)&&(l=new Uint8Array(s.memory.buffer)),l}let m=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});m.decode();const x=2146435072;let b=0;function O(n,e){return b+=e,b>=x&&(m=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),m.decode(),b=e),m.decode(d().subarray(n,n+e))}function w(n,e){return n=n>>>0,O(n,e)}function u(n,e){return n=n>>>0,d().subarray(n/1,n/1+e)}function F(n){const e=s.__externref_table_alloc();return s.__wbindgen_externrefs.set(e,n),e}function I(n,e){try{return n.apply(this,e)}catch(t){const r=F(t);s.__wbindgen_exn_store(r)}}let S=0;const h=new TextEncoder;"encodeInto"in h||(h.encodeInto=function(n,e){const t=h.encode(n);return e.set(t),{read:n.length,written:t.length}});function L(n,e,t){if(t===void 0){const _=h.encode(n),p=e(_.length,1)>>>0;return d().subarray(p,p+_.length).set(_),S=_.length,p}let r=n.length,i=e(r,1)>>>0;const o=d();let a=0;for(;a<r;a++){const _=n.charCodeAt(a);if(_>127)break;o[i+a]=_}if(a!==r){a!==0&&(n=n.slice(a)),i=t(i,r,r=a+n.length*3,1)>>>0;const _=d().subarray(i+a,i+r),p=h.encodeInto(n,_);a+=p.written,i=t(i,r,a,1)>>>0}return S=a,i}let c=null;function T(){return(c===null||c.buffer.detached===!0||c.buffer.detached===void 0&&c.buffer!==s.memory.buffer)&&(c=new DataView(s.memory.buffer)),c}function y(n){const e=s.__wbindgen_externrefs.get(n);return s.__externref_table_dealloc(n),e}const M=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>s.__wbg_game_free(n>>>0,1));class g{static __wrap(e){e=e>>>0;const t=Object.create(g.prototype);return t.__wbg_ptr=e,M.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,M.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_game_free(e,0)}get_visits(){return s.game_get_visits(this.__wbg_ptr)}place_info(e){const t=s.game_place_info(this.__wbg_ptr,e);return f.__wrap(t)}is_drafting(){return s.game_is_drafting(this.__wbg_ptr)!==0}take_action(){const e=s.game_take_action(this.__wbg_ptr);if(e[1])throw y(e[0])}move_penguin(e,t){const r=s.game_move_penguin(this.__wbg_ptr,e,t);if(r[1])throw y(r[0])}active_player(){const e=s.game_active_player(this.__wbg_ptr);return e===16777215?void 0:e}place_penguin(e){const t=s.game_place_penguin(this.__wbg_ptr,e);if(t[1])throw y(t[0])}possible_moves(e){const t=s.game_possible_moves(this.__wbg_ptr,e);var r=u(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*1,1),r}draftable_cells(){const e=s.game_draftable_cells(this.__wbg_ptr);var t=u(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*1,1),t}playout_n_times(e){s.game_playout_n_times(this.__wbg_ptr,e)}finished_drafting(){return s.game_finished_drafting(this.__wbg_ptr)!==0}get_total_playouts(){return s.game_get_total_playouts(this.__wbg_ptr)>>>0}static new(){const e=s.game_new();return g.__wrap(e)}turn(){return s.game_turn(this.__wbg_ptr)>>>0}score(e){return s.game_score(this.__wbg_ptr,e)>>>0}claimed(e){const t=s.game_claimed(this.__wbg_ptr,e);var r=u(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*1,1),r}playout(){s.game_playout(this.__wbg_ptr)}num_fish(e){return s.game_num_fish(this.__wbg_ptr,e)>>>0}penguins(e){const t=s.game_penguins(this.__wbg_ptr,e);var r=u(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*1,1),r}game_over(){return s.game_game_over(this.__wbg_ptr)!==0}move_info(e,t){const r=s.game_move_info(this.__wbg_ptr,e,t);return f.__wrap(r)}tree_size(){return s.game_tree_size(this.__wbg_ptr)>>>0}}Symbol.dispose&&(g.prototype[Symbol.dispose]=g.prototype.free);const P=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>s.__wbg_moveinfo_free(n>>>0,1));class f{static __wrap(e){e=e>>>0;const t=Object.create(f.prototype);return t.__wbg_ptr=e,P.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,P.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_moveinfo_free(e,0)}get_visits(){return s.moveinfo_get_visits(this.__wbg_ptr)}get_rewards(){return s.moveinfo_get_rewards(this.__wbg_ptr)}}Symbol.dispose&&(f.prototype[Symbol.dispose]=f.prototype.free);const U=new Set(["basic","cors","default"]);async function D(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.ok&&U.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function N(){const n={};return n.wbg={},n.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(e,t){throw new Error(w(e,t))},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,i;try{r=e,i=t,console.error(w(e,t))}finally{s.__wbindgen_free(r,i,1)}},n.wbg.__wbg_getRandomValues_1c61fac11405ffdc=function(){return I(function(e,t){globalThis.crypto.getRandomValues(u(e,t))},arguments)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const r=t.stack,i=L(r,s.__wbindgen_malloc,s.__wbindgen_realloc),o=S;T().setInt32(e+4,o,!0),T().setInt32(e+0,i,!0)},n.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,t){return w(e,t)},n.wbg.__wbindgen_init_externref_table=function(){const e=s.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n}function W(n,e){return s=n.exports,k.__wbindgen_wasm_module=e,c=null,l=null,s.__wbindgen_start(),s}async function k(n){if(s!==void 0)return s;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL(""+new URL("htmf_wasm_bg-DP8oI7RD.wasm",import.meta.url).href,import.meta.url));const e=N();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await D(await n,e);return W(t,r)}const z=2,C=0,v=1,E=8,Y=7,j=8,B=Y*(E/2)+j*(E/2),V=200,R=28e3,A=12e4;function G(n){const e=[];for(let o=0;o<B;++o)e.push(n.num_fish(o));const t=[],r=[],i=[];for(let o=0;o<z;++o)t.push(n.score(o)),r.push([...n.penguins(o)]),i.push([...n.claimed(o)]);return{activePlayer:n.active_player(),modeType:n.finished_drafting()?"playing":"drafting",scores:t,turn:n.turn(),board:{fish:e,penguins:r,claimed:i}}}function X(n,e){if(n.active_player()!==C)return[];if(n.finished_drafting()){if(e!==void 0)return[...n.possible_moves(e)];const t=n.active_player();return t===void 0?[]:[...n.penguins(t)]}else return[...n.draftable_cells()]}class H{wasmInternals;game=g.new();postMessage;ponderer;forcedMove=!1;ponderStartTime;totalCompletedPonderTimeMs=0;constructor(e,t){this.wasmInternals=e,this.postMessage=t,this.ponder(),this.postGameState({})}free(){this.stopPondering(),this.game.free(),this.totalCompletedPonderTimeMs=0}ponder(){this.ponderer===void 0&&(this.ponderStartTime=performance.now(),this.ponderer=self.setInterval(()=>{const e=this.game.active_player();e===v?(this.forcedMove||this.game.get_visits()>=R)&&(this.game.take_action(),this.forcedMove=!1,this.postGameState({}),this.ponder()):(e===void 0||this.game.get_visits()>=A)&&this.stopPondering(),this.game.playout_n_times(V),this.postThinkingProgress()}))}moveNow(){this.forcedMove=!0,this.game.active_player()===v&&this.ponder()}stopPondering(){this.ponderer!==void 0&&(clearInterval(this.ponderer),this.ponderer=void 0),this.ponderStartTime!==void 0&&(this.totalCompletedPonderTimeMs+=performance.now()-this.ponderStartTime,this.ponderStartTime=void 0),this.postThinkingProgress()}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout()}getState(){return G(this.game)}getPossibleMoves(e){return X(this.game,e)}onMessage(e){let t,r=!1;switch(e.type){case"getGameState":break;case"movePenguin":try{e.src===void 0?this.placePenguin(e.dst):this.movePenguin(e.src,e.dst)}catch{r=!0}break;case"getPossibleMoves":t=e.src;break;case"pausePondering":this.stopPondering();return;case"resumePondering":this.ponder();return;case"moveNow":this.moveNow();return}this.postGameState({src:t,lastMoveWasIllegal:r})}postGameState({src:e,lastMoveWasIllegal:t}){t=t===!0;const r=this.postMessage;r({type:"gameState",gameState:this.getState(),possibleMoves:this.getPossibleMoves(e),lastMoveWasIllegal:t})}postThinkingProgress(){const e=this.game.active_player(),t=this.postMessage;t({type:"thinkingProgress",completed:this.game.get_visits(),required:e===v?R:A,totalPlayouts:this.game.get_total_playouts(),totalTimeThinkingMs:this.getTotalTimeThinkingMs(),memoryUsage:this.wasmInternals.memory.buffer.byteLength,isPondering:this.ponderer!==void 0,treeSize:this.game.tree_size(),playerMoveScores:e!==void 0?{player:e,moveScores:this.getMoveScores(e)}:{}})}getMoveScores(e){const t=[];if(this.game.is_drafting())for(const r of this.game.draftable_cells()){const i=this.game.place_info(r);t.push({dst:r,visits:i.get_visits(),rewards:i.get_rewards()})}else for(const r of this.game.penguins(e))for(const i of this.game.possible_moves(r)){const o=this.game.move_info(r,i);t.push({src:r,dst:i,visits:o.get_visits(),rewards:o.get_rewards()})}return t}getTotalTimeThinkingMs(){let e=this.totalCompletedPonderTimeMs;return this.ponderStartTime!==void 0&&(e+=performance.now()-this.ponderStartTime),e}}const K=await k(),Z=new H(K,postMessage);onmessage=n=>{Z.onMessage(n.data)};
//# sourceMappingURL=bot.worker-Bz1T4DrS.js.map
