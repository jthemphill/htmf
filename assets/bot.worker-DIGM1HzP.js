let s,p=null;function d(){return(p===null||p.byteLength===0)&&(p=new Uint8Array(s.memory.buffer)),p}let m=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});m.decode();const O=2146435072;let w=0;function F(n,e){return w+=e,w>=O&&(m=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),m.decode(),w=e),m.decode(d().subarray(n,n+e))}function h(n,e){return n=n>>>0,F(n,e)}function U(n){const e=s.__externref_table_alloc();return s.__wbindgen_externrefs.set(e,n),e}function I(n,e){try{return n.apply(this,e)}catch(t){const r=U(t);s.__wbindgen_exn_store(r)}}function u(n,e){return n=n>>>0,d().subarray(n/1,n/1+e)}let v=0;const b=new TextEncoder;"encodeInto"in b||(b.encodeInto=function(n,e){const t=b.encode(n);return e.set(t),{read:n.length,written:t.length}});function L(n,e,t){if(t===void 0){const _=b.encode(n),l=e(_.length,1)>>>0;return d().subarray(l,l+_.length).set(_),v=_.length,l}let r=n.length,i=e(r,1)>>>0;const o=d();let a=0;for(;a<r;a++){const _=n.charCodeAt(a);if(_>127)break;o[i+a]=_}if(a!==r){a!==0&&(n=n.slice(a)),i=t(i,r,r=a+n.length*3,1)>>>0;const _=d().subarray(i+a,i+r),l=b.encodeInto(n,_);a+=l.written,i=t(i,r,a,1)>>>0}return v=a,i}let c=null;function T(){return(c===null||c.buffer.detached===!0||c.buffer.detached===void 0&&c.buffer!==s.memory.buffer)&&(c=new DataView(s.memory.buffer)),c}function W(n){return s.initThreadPool(n)}function y(n){const e=s.__wbindgen_externrefs.get(n);return s.__externref_table_dealloc(n),e}const S=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>s.__wbg_game_free(n>>>0,1));class g{static __wrap(e){e=e>>>0;const t=Object.create(g.prototype);return t.__wbg_ptr=e,S.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,S.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_game_free(e,0)}get_visits(){return s.game_get_visits(this.__wbg_ptr)}place_info(e){const t=s.game_place_info(this.__wbg_ptr,e);return f.__wrap(t)}is_drafting(){return s.game_is_drafting(this.__wbg_ptr)!==0}take_action(){const e=s.game_take_action(this.__wbg_ptr);if(e[1])throw y(e[0])}move_penguin(e,t){const r=s.game_move_penguin(this.__wbg_ptr,e,t);if(r[1])throw y(r[0])}active_player(){const e=s.game_active_player(this.__wbg_ptr);return e===16777215?void 0:e}place_penguin(e){const t=s.game_place_penguin(this.__wbg_ptr,e);if(t[1])throw y(t[0])}possible_moves(e){const t=s.game_possible_moves(this.__wbg_ptr,e);var r=u(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*1,1),r}draftable_cells(){const e=s.game_draftable_cells(this.__wbg_ptr);var t=u(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*1,1),t}playout_n_times(e){s.game_playout_n_times(this.__wbg_ptr,e)}finished_drafting(){return s.game_finished_drafting(this.__wbg_ptr)!==0}get_total_playouts(){return s.game_get_total_playouts(this.__wbg_ptr)>>>0}static new(){const e=s.game_new();return g.__wrap(e)}turn(){return s.game_turn(this.__wbg_ptr)>>>0}score(e){return s.game_score(this.__wbg_ptr,e)>>>0}claimed(e){const t=s.game_claimed(this.__wbg_ptr,e);var r=u(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*1,1),r}playout(){s.game_playout(this.__wbg_ptr)}num_fish(e){return s.game_num_fish(this.__wbg_ptr,e)>>>0}penguins(e){const t=s.game_penguins(this.__wbg_ptr,e);var r=u(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*1,1),r}game_over(){return s.game_game_over(this.__wbg_ptr)!==0}move_info(e,t){const r=s.game_move_info(this.__wbg_ptr,e,t);return f.__wrap(r)}tree_size(){return s.game_tree_size(this.__wbg_ptr)>>>0}}Symbol.dispose&&(g.prototype[Symbol.dispose]=g.prototype.free);const M=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>s.__wbg_moveinfo_free(n>>>0,1));class f{static __wrap(e){e=e>>>0;const t=Object.create(f.prototype);return t.__wbg_ptr=e,M.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,M.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_moveinfo_free(e,0)}get_visits(){return s.moveinfo_get_visits(this.__wbg_ptr)}get_rewards(){return s.moveinfo_get_rewards(this.__wbg_ptr)}}Symbol.dispose&&(f.prototype[Symbol.dispose]=f.prototype.free);const C=new Set(["basic","cors","default"]);async function N(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.ok&&C.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function z(){const n={};return n.wbg={},n.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(e,t){throw new Error(h(e,t))},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,i;try{r=e,i=t,console.error(h(e,t))}finally{s.__wbindgen_free(r,i,1)}},n.wbg.__wbg_getRandomValues_ea728b1d79dae146=function(){return I(function(e){globalThis.crypto.getRandomValues(e)},arguments)},n.wbg.__wbg_length_69bca3cb64fc8748=function(e){return e.length},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_new_with_length_01aa0dc35aa13543=function(e){return new Uint8Array(e>>>0)},n.wbg.__wbg_prototypesetcall_2a6620b6922694b2=function(e,t,r){Uint8Array.prototype.set.call(u(e,t),r)},n.wbg.__wbg_resolve_caf97c30b83f7053=function(e){return Promise.resolve(e)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const r=t.stack,i=L(r,s.__wbindgen_malloc,s.__wbindgen_realloc),o=v;T().setInt32(e+4,o,!0),T().setInt32(e+0,i,!0)},n.wbg.__wbg_subarray_480600f3d6a9f26c=function(e,t,r){return e.subarray(t>>>0,r>>>0)},n.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,t){return h(e,t)},n.wbg.__wbindgen_init_externref_table=function(){const e=s.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n}function D(n,e){return s=n.exports,x.__wbindgen_wasm_module=e,c=null,p=null,s.__wbindgen_start(),s}async function x(n){if(s!==void 0)return s;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL(""+new URL("htmf_wasm_bg-BnEo8nY5.wasm",import.meta.url).href,import.meta.url));const e=z();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await N(await n,e);return D(t,r)}const Y=2,B=0,P=1,A=8,j=7,V=8,G=j*(A/2)+V*(A/2),E=200,R=14e3,k=12e4;function X(n){const e=[];for(let o=0;o<G;++o)e.push(n.num_fish(o));const t=[],r=[],i=[];for(let o=0;o<Y;++o)t.push(n.score(o)),r.push([...n.penguins(o)]),i.push([...n.claimed(o)]);return{activePlayer:n.active_player(),modeType:n.finished_drafting()?"playing":"drafting",scores:t,turn:n.turn(),board:{fish:e,penguins:r,claimed:i}}}function H(n,e){if(n.active_player()!==B)return[];if(n.finished_drafting()){if(e!==void 0)return[...n.possible_moves(e)];const t=n.active_player();return t===void 0?[]:[...n.penguins(t)]}else return[...n.draftable_cells()]}class K{wasmInternals;game=g.new();postMessage;ponderer;ponderStartTime;totalCompletedPonderTimeMs=0;constructor(e,t){this.wasmInternals=e,this.postMessage=t,this.ponder(),this.postGameState({})}free(){this.stopPondering(),this.game.free(),this.totalCompletedPonderTimeMs=0}ponder(){this.ponderer===void 0&&(this.ponderStartTime=performance.now(),this.ponderer=self.setInterval(()=>{const e=this.game.active_player();if(this.game.get_visits()>=k||e===P){this.stopPondering();return}this.game.playout_n_times(E),e!==void 0&&this.postThinkingProgress({activePlayer:e,playoutsNeeded:k})}))}stopPondering(){this.ponderer!==void 0&&(clearInterval(this.ponderer),this.ponderer=void 0),this.ponderStartTime!==void 0&&(this.totalCompletedPonderTimeMs+=performance.now()-this.ponderStartTime,this.ponderStartTime=void 0)}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout()}takeAction(){const e=this.game.turn()<2?2*R:R;let t=performance.now();for(;this.game.get_visits()<e;){this.game.playout_n_times(E),this.totalCompletedPonderTimeMs+=performance.now()-t,t=performance.now();const r=this.game.active_player();r!==void 0&&this.postThinkingProgress({activePlayer:r,playoutsNeeded:e})}this.totalCompletedPonderTimeMs+=performance.now()-t,t=performance.now(),this.game.take_action(),this.postGameState({}),this.ponder()}getState(){return X(this.game)}getPossibleMoves(e){return H(this.game,e)}onMessage(e){console.log(`received request ${e.type}`);let t,r=!1;switch(e.type){case"getGameState":break;case"movePenguin":try{e.src===void 0?this.placePenguin(e.dst):this.movePenguin(e.src,e.dst)}catch{r=!0}break;case"getPossibleMoves":t=e.src;break}for(this.postGameState({src:t,lastMoveWasIllegal:r});this.game.active_player()===P;)this.takeAction()}postGameState({src:e,lastMoveWasIllegal:t}){t=t===!0;const r=this.postMessage;r({type:"gameState",gameState:this.getState(),possibleMoves:this.getPossibleMoves(e),lastMoveWasIllegal:t})}postThinkingProgress({activePlayer:e,playoutsNeeded:t}){const r=this.postMessage;r({type:"thinkingProgress",completed:this.game.get_visits(),required:t,totalPlayouts:this.game.get_total_playouts(),totalTimeThinkingMs:this.getTotalTimeThinkingMs(),memoryUsage:this.wasmInternals.memory.buffer.byteLength,treeSize:this.game.tree_size(),playerMoveScores:{player:e,moveScores:this.getMoveScores(e)}})}getMoveScores(e){const t=[];if(this.game.is_drafting())for(const r of this.game.draftable_cells()){const i=this.game.place_info(r);t.push({dst:r,visits:i.get_visits(),rewards:i.get_rewards()})}else for(const r of this.game.penguins(e))for(const i of this.game.possible_moves(r)){const o=this.game.move_info(r,i);t.push({src:r,dst:i,visits:o.get_visits(),rewards:o.get_rewards()})}return t}getTotalTimeThinkingMs(){let e=this.totalCompletedPonderTimeMs;return this.ponderStartTime!==void 0&&(e+=performance.now()-this.ponderStartTime),e}}const Z=new WebAssembly.Memory({initial:18,maximum:16384,shared:!0}),$=await x({memory:Z});await W(navigator.hardwareConcurrency);const J=new K($,postMessage);onmessage=n=>{J.onMessage(n.data)};
//# sourceMappingURL=bot.worker-DIGM1HzP.js.map
