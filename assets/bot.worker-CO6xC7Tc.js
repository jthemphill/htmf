let i;const F=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&F.decode();let w=null;function m(){return(w===null||w.buffer!==i.memory.buffer)&&(w=new Uint8Array(i.memory.buffer)),w}function y(n,e){return n=n>>>0,F.decode(m().slice(n,n+e))}const b=new Array(128).fill(void 0);b.push(void 0,null,!0,!1);let h=b.length;function a(n){h===b.length&&b.push(b.length+1);const e=h;return h=b[e],b[e]=n,e}function _(n){return b[n]}function j(n){n<132||(b[n]=h,h=n)}function d(n){const e=_(n);return j(n),e}function x(n){const e=i.initThreadPool(n);return d(e)}let p=null;function c(){return(p===null||p.buffer!==i.memory.buffer)&&(p=new DataView(i.memory.buffer)),p}function v(n,e){return n=n>>>0,m().subarray(n/1,n/1+e)}let S=0;const U=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},C=function(n,e){const t=U.encode(n);return e.set(t),{read:n.length,written:t.length}};function W(n,e,t){if(t===void 0){const u=U.encode(n),l=e(u.length,1)>>>0;return m().subarray(l,l+u.length).set(u),S=u.length,l}let r=n.length,s=e(r,1)>>>0;const o=m();let g=0;for(;g<r;g++){const u=n.charCodeAt(g);if(u>127)break;o[s+g]=u}if(g!==r){g!==0&&(n=n.slice(g)),s=t(s,r,r=g+n.length*3,1)>>>0;const u=m().subarray(s+g,s+r),l=C(n,u);g+=l.written,s=t(s,r,g,1)>>>0}return S=g,s}function f(n,e){try{return n.apply(this,e)}catch(t){i.__wbindgen_exn_store(a(t))}}const P=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>i.__wbg_game_free(n>>>0,1));class T{static __wrap(e){e=e>>>0;const t=Object.create(T.prototype);return t.__wbg_ptr=e,P.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,P.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_game_free(e,0)}static new(){const e=i.game_new();return T.__wrap(e)}is_drafting(){return i.game_is_drafting(this.__wbg_ptr)!==0}finished_drafting(){return i.game_finished_drafting(this.__wbg_ptr)!==0}game_over(){return i.game_game_over(this.__wbg_ptr)!==0}active_player(){const e=i.game_active_player(this.__wbg_ptr);return e===16777215?void 0:e}score(e){return i.game_score(this.__wbg_ptr,e)>>>0}turn(){return i.game_turn(this.__wbg_ptr)>>>0}num_fish(e){return i.game_num_fish(this.__wbg_ptr,e)>>>0}penguins(e){try{const o=i.__wbindgen_add_to_stack_pointer(-16);i.game_penguins(o,this.__wbg_ptr,e);var t=c().getInt32(o+4*0,!0),r=c().getInt32(o+4*1,!0),s=v(t,r).slice();return i.__wbindgen_free(t,r*1,1),s}finally{i.__wbindgen_add_to_stack_pointer(16)}}claimed(e){try{const o=i.__wbindgen_add_to_stack_pointer(-16);i.game_claimed(o,this.__wbg_ptr,e);var t=c().getInt32(o+4*0,!0),r=c().getInt32(o+4*1,!0),s=v(t,r).slice();return i.__wbindgen_free(t,r*1,1),s}finally{i.__wbindgen_add_to_stack_pointer(16)}}draftable_cells(){try{const s=i.__wbindgen_add_to_stack_pointer(-16);i.game_draftable_cells(s,this.__wbg_ptr);var e=c().getInt32(s+4*0,!0),t=c().getInt32(s+4*1,!0),r=v(e,t).slice();return i.__wbindgen_free(e,t*1,1),r}finally{i.__wbindgen_add_to_stack_pointer(16)}}possible_moves(e){try{const o=i.__wbindgen_add_to_stack_pointer(-16);i.game_possible_moves(o,this.__wbg_ptr,e);var t=c().getInt32(o+4*0,!0),r=c().getInt32(o+4*1,!0),s=v(t,r).slice();return i.__wbindgen_free(t,r*1,1),s}finally{i.__wbindgen_add_to_stack_pointer(16)}}place_penguin(e){try{const s=i.__wbindgen_add_to_stack_pointer(-16);i.game_place_penguin(s,this.__wbg_ptr,e);var t=c().getInt32(s+4*0,!0),r=c().getInt32(s+4*1,!0);if(r)throw d(t)}finally{i.__wbindgen_add_to_stack_pointer(16)}}move_penguin(e,t){try{const o=i.__wbindgen_add_to_stack_pointer(-16);i.game_move_penguin(o,this.__wbg_ptr,e,t);var r=c().getInt32(o+4*0,!0),s=c().getInt32(o+4*1,!0);if(s)throw d(r)}finally{i.__wbindgen_add_to_stack_pointer(16)}}playout(){i.game_playout(this.__wbg_ptr)}playout_n_times(e){i.game_playout_n_times(this.__wbg_ptr,e)}get_total_playouts(){return i.game_get_total_playouts(this.__wbg_ptr)>>>0}get_visits(){return i.game_get_visits(this.__wbg_ptr)}place_info(e){const t=i.game_place_info(this.__wbg_ptr,e);return M.__wrap(t)}move_info(e,t){const r=i.game_move_info(this.__wbg_ptr,e,t);return M.__wrap(r)}take_action(){try{const r=i.__wbindgen_add_to_stack_pointer(-16);i.game_take_action(r,this.__wbg_ptr);var e=c().getInt32(r+4*0,!0),t=c().getInt32(r+4*1,!0);if(t)throw d(e)}finally{i.__wbindgen_add_to_stack_pointer(16)}}tree_size(){return i.game_tree_size(this.__wbg_ptr)>>>0}}const k=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>i.__wbg_moveinfo_free(n>>>0,1));class M{static __wrap(e){e=e>>>0;const t=Object.create(M.prototype);return t.__wbg_ptr=e,k.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,k.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_moveinfo_free(e,0)}get_visits(){return i.moveinfo_get_visits(this.__wbg_ptr)}get_rewards(){return i.moveinfo_get_rewards(this.__wbg_ptr)}}async function N(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function z(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,t){const r=y(e,t);return a(r)},n.wbg.__wbindgen_object_drop_ref=function(e){d(e)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return a(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=_(t).stack,s=W(r,i.__wbindgen_malloc,i.__wbindgen_realloc),o=S;c().setInt32(e+4*1,o,!0),c().setInt32(e+4*0,s,!0)},n.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,s;try{r=e,s=t,console.error(y(e,t))}finally{i.__wbindgen_free(r,s,1)}},n.wbg.__wbg_crypto_1d1f22824a6a080c=function(e){const t=_(e).crypto;return a(t)},n.wbg.__wbindgen_is_object=function(e){const t=_(e);return typeof t=="object"&&t!==null},n.wbg.__wbg_process_4a72847cc503995b=function(e){const t=_(e).process;return a(t)},n.wbg.__wbg_versions_f686565e586dd935=function(e){const t=_(e).versions;return a(t)},n.wbg.__wbg_node_104a2ff8d6ea03a2=function(e){const t=_(e).node;return a(t)},n.wbg.__wbindgen_is_string=function(e){return typeof _(e)=="string"},n.wbg.__wbg_require_cca90b1a94a0255b=function(){return f(function(){const e=module.require;return a(e)},arguments)},n.wbg.__wbindgen_is_function=function(e){return typeof _(e)=="function"},n.wbg.__wbg_msCrypto_eb05e62b530a1508=function(e){const t=_(e).msCrypto;return a(t)},n.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return f(function(e,t){_(e).randomFillSync(d(t))},arguments)},n.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return f(function(e,t){_(e).getRandomValues(_(t))},arguments)},n.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,t){const r=new Function(y(e,t));return a(r)},n.wbg.__wbg_call_1084a111329e68ce=function(){return f(function(e,t){const r=_(e).call(_(t));return a(r)},arguments)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=_(e);return a(t)},n.wbg.__wbg_self_3093d5d1f7bcb682=function(){return f(function(){const e=self.self;return a(e)},arguments)},n.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return f(function(){const e=window.window;return a(e)},arguments)},n.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return f(function(){const e=globalThis.globalThis;return a(e)},arguments)},n.wbg.__wbg_global_e5a3fe56f8be9485=function(){return f(function(){const e=global.global;return a(e)},arguments)},n.wbg.__wbindgen_is_undefined=function(e){return _(e)===void 0},n.wbg.__wbg_call_89af060b4e1523f2=function(){return f(function(e,t,r){const s=_(e).call(_(t),_(r));return a(s)},arguments)},n.wbg.__wbg_resolve_570458cb99d56a43=function(e){const t=Promise.resolve(_(e));return a(t)},n.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){const t=_(e).buffer;return a(t)},n.wbg.__wbg_newwithbyteoffsetandlength_8a2cb9ca96b27ec9=function(e,t,r){const s=new Uint8Array(_(e),t>>>0,r>>>0);return a(s)},n.wbg.__wbg_new_ea1883e1e5e86686=function(e){const t=new Uint8Array(_(e));return a(t)},n.wbg.__wbg_set_d1e79e2388520f18=function(e,t,r){_(e).set(_(t),r>>>0)},n.wbg.__wbg_newwithlength_ec548f448387c968=function(e){const t=new Uint8Array(e>>>0);return a(t)},n.wbg.__wbg_subarray_7c2e3576afe181d1=function(e,t,r){const s=_(e).subarray(t>>>0,r>>>0);return a(s)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(y(e,t))},n.wbg.__wbindgen_memory=function(){const e=i.memory;return a(e)},n}function D(n,e){n.wbg.memory=e||new WebAssembly.Memory({initial:18,maximum:16384,shared:!0})}function V(n,e,t){if(i=n.exports,L.__wbindgen_wasm_module=e,p=null,w=null,typeof t<"u"&&(typeof t!="number"||t===0||t%65536!==0))throw"invalid stack size";return i.__wbindgen_start(t),i}async function L(n,e){if(i!==void 0)return i;let t;typeof n<"u"&&Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n,memory:e,thread_stack_size:t}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof n>"u"&&(n=new URL(""+new URL("htmf_wasm_bg-CXAybMk3.wasm",import.meta.url).href,import.meta.url));const r=z();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n)),D(r,e);const{instance:s,module:o}=await N(await n,r);return V(s,o,t)}const G=2,Y=0,A=1,I=8,B=7,H=8,X=B*(I/2)+H*(I/2),E=200,R=14e3,O=6e4;function K(n){const e=[];for(let o=0;o<X;++o)e.push(n.num_fish(o));const t=[],r=[],s=[];for(let o=0;o<G;++o)t.push(n.score(o)),r.push([...n.penguins(o)]),s.push([...n.claimed(o)]);return{activePlayer:n.active_player(),modeType:n.finished_drafting()?"playing":"drafting",scores:t,turn:n.turn(),board:{fish:e,penguins:r,claimed:s}}}function Z(n,e){if(n.active_player()!==Y)return[];if(n.finished_drafting()){if(e!==void 0)return[...n.possible_moves(e)];const t=n.active_player();return t===void 0?[]:[...n.penguins(t)]}else return[...n.draftable_cells()]}class ${wasmInternals;game=T.new();postMessage;ponderer;ponderStartTime;totalCompletedPonderTimeMs=0;constructor(e,t){this.wasmInternals=e,this.postMessage=t,this.ponder(),this.postGameState({})}free(){this.stopPondering(),this.game.free(),this.totalCompletedPonderTimeMs=0}ponder(){this.ponderer===void 0&&(this.ponderStartTime=performance.now(),this.ponderer=self.setInterval(()=>{const e=this.game.active_player();if(this.game.get_visits()>=O||e===A){this.stopPondering();return}this.game.playout_n_times(E),e!==void 0&&this.postThinkingProgress({activePlayer:e,playoutsNeeded:O})}))}stopPondering(){this.ponderer!==void 0&&(clearInterval(this.ponderer),this.ponderer=void 0),this.ponderStartTime!==void 0&&(this.totalCompletedPonderTimeMs+=performance.now()-this.ponderStartTime,this.ponderStartTime=void 0)}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout()}takeAction(){const e=this.game.turn()<2?2*R:R;let t=performance.now();for(;this.game.get_visits()<e;){this.game.playout_n_times(E),this.totalCompletedPonderTimeMs+=performance.now()-t,t=performance.now();const r=this.game.active_player();r!==void 0&&this.postThinkingProgress({activePlayer:r,playoutsNeeded:e})}this.totalCompletedPonderTimeMs+=performance.now()-t,t=performance.now(),this.game.take_action(),this.postGameState({}),this.ponder()}getState(){return K(this.game)}getPossibleMoves(e){return Z(this.game,e)}onMessage(e){console.log(`received request ${e.type}`);let t,r=!1;switch(e.type){case"getGameState":break;case"movePenguin":try{e.src===void 0?this.placePenguin(e.dst):this.movePenguin(e.src,e.dst)}catch{r=!0}break;case"getPossibleMoves":t=e.src;break}for(this.postGameState({src:t,lastMoveWasIllegal:r});this.game.active_player()===A;)this.takeAction()}postGameState({src:e,lastMoveWasIllegal:t}){t=t===!0;const r=this.postMessage;r({type:"gameState",gameState:this.getState(),possibleMoves:this.getPossibleMoves(e),lastMoveWasIllegal:t})}postThinkingProgress({activePlayer:e,playoutsNeeded:t}){const r=this.postMessage;r({type:"thinkingProgress",completed:this.game.get_visits(),required:t,totalPlayouts:this.game.get_total_playouts(),totalTimeThinkingMs:this.getTotalTimeThinkingMs(),memoryUsage:this.wasmInternals.memory.buffer.byteLength,treeSize:this.game.tree_size(),playerMoveScores:{player:e,moveScores:this.getMoveScores(e)}})}getMoveScores(e){const t=[];if(this.game.is_drafting())for(const r of this.game.draftable_cells()){const s=this.game.place_info(r);t.push({dst:r,visits:s.get_visits(),rewards:s.get_rewards()})}else for(const r of this.game.penguins(e))for(const s of this.game.possible_moves(r)){const o=this.game.move_info(r,s);t.push({src:r,dst:s,visits:o.get_visits(),rewards:o.get_rewards()})}return t}getTotalTimeThinkingMs(){let e=this.totalCompletedPonderTimeMs;return this.ponderStartTime!==void 0&&(e+=performance.now()-this.ponderStartTime),e}}const q=new WebAssembly.Memory({initial:18,maximum:16384,shared:!0}),J=await L({memory:q});await x(navigator.hardwareConcurrency);const Q=new $(J,postMessage);onmessage=n=>{Q.onMessage(n.data)};
//# sourceMappingURL=bot.worker-CO6xC7Tc.js.map
