let r;const I=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&I.decode();let b=null;function w(){return(b===null||b.byteLength===0)&&(b=new Uint8Array(r.memory.buffer)),b}function v(n,e){return n=n>>>0,I.decode(w().subarray(n,n+e))}const l=new Array(128).fill(void 0);l.push(void 0,null,!0,!1);let h=l.length;function a(n){h===l.length&&l.push(l.length+1);const e=h;return h=l[e],l[e]=n,e}function _(n){return l[n]}function U(n){n<132||(l[n]=h,h=n)}function m(n){const e=_(n);return U(n),e}let p=null;function c(){return(p===null||p.byteLength===0)&&(p=new Int32Array(r.memory.buffer)),p}function M(n,e){return n=n>>>0,w().subarray(n/1,n/1+e)}let P=0;const S=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},O=typeof S.encodeInto=="function"?function(n,e){return S.encodeInto(n,e)}:function(n,e){const t=S.encode(n);return e.set(t),{read:n.length,written:t.length}};function W(n,e,t){if(t===void 0){const f=S.encode(n),d=e(f.length,1)>>>0;return w().subarray(d,d+f.length).set(f),P=f.length,d}let s=n.length,o=e(s,1)>>>0;const i=w();let g=0;for(;g<s;g++){const f=n.charCodeAt(g);if(f>127)break;i[o+g]=f}if(g!==s){g!==0&&(n=n.slice(g)),o=t(o,s,s=g+n.length*3,1)>>>0;const f=w().subarray(o+g,o+s),d=O(n,f);g+=d.written}return P=g,o}function u(n,e){try{return n.apply(this,e)}catch(t){r.__wbindgen_exn_store(a(t))}}class y{static __wrap(e){e=e>>>0;const t=Object.create(y.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_game_free(e)}static new(){const e=r.game_new();return y.__wrap(e)}is_drafting(){return r.game_is_drafting(this.__wbg_ptr)!==0}finished_drafting(){return r.game_finished_drafting(this.__wbg_ptr)!==0}game_over(){return r.game_game_over(this.__wbg_ptr)!==0}active_player(){const e=r.game_active_player(this.__wbg_ptr);return e===16777215?void 0:e}score(e){return r.game_score(this.__wbg_ptr,e)>>>0}turn(){return r.game_turn(this.__wbg_ptr)>>>0}num_fish(e){return r.game_num_fish(this.__wbg_ptr,e)>>>0}penguins(e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.game_penguins(i,this.__wbg_ptr,e);var t=c()[i/4+0],s=c()[i/4+1],o=M(t,s).slice();return r.__wbindgen_free(t,s*1),o}finally{r.__wbindgen_add_to_stack_pointer(16)}}claimed(e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.game_claimed(i,this.__wbg_ptr,e);var t=c()[i/4+0],s=c()[i/4+1],o=M(t,s).slice();return r.__wbindgen_free(t,s*1),o}finally{r.__wbindgen_add_to_stack_pointer(16)}}draftable_cells(){try{const o=r.__wbindgen_add_to_stack_pointer(-16);r.game_draftable_cells(o,this.__wbg_ptr);var e=c()[o/4+0],t=c()[o/4+1],s=M(e,t).slice();return r.__wbindgen_free(e,t*1),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}possible_moves(e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.game_possible_moves(i,this.__wbg_ptr,e);var t=c()[i/4+0],s=c()[i/4+1],o=M(t,s).slice();return r.__wbindgen_free(t,s*1),o}finally{r.__wbindgen_add_to_stack_pointer(16)}}place_penguin(e){try{const o=r.__wbindgen_add_to_stack_pointer(-16);r.game_place_penguin(o,this.__wbg_ptr,e);var t=c()[o/4+0],s=c()[o/4+1];if(s)throw m(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}move_penguin(e,t){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.game_move_penguin(i,this.__wbg_ptr,e,t);var s=c()[i/4+0],o=c()[i/4+1];if(o)throw m(s)}finally{r.__wbindgen_add_to_stack_pointer(16)}}playout(){r.game_playout(this.__wbg_ptr)}get_visits(){return r.game_get_visits(this.__wbg_ptr)}place_info(e){const t=r.game_place_info(this.__wbg_ptr,e);return k.__wrap(t)}move_info(e,t){const s=r.game_move_info(this.__wbg_ptr,e,t);return k.__wrap(s)}take_action(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.game_take_action(s,this.__wbg_ptr);var e=c()[s/4+0],t=c()[s/4+1];if(t)throw m(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}tree_size(){return r.game_tree_size(this.__wbg_ptr)>>>0}}class k{static __wrap(e){e=e>>>0;const t=Object.create(k.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_moveinfo_free(e)}get_visits(){return r.moveinfo_get_visits(this.__wbg_ptr)}get_rewards(){return r.moveinfo_get_rewards(this.__wbg_ptr)}}async function x(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(s){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function F(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,t){const s=v(e,t);return a(s)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return a(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const s=_(t).stack,o=W(s,r.__wbindgen_malloc,r.__wbindgen_realloc),i=P;c()[e/4+1]=i,c()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let s,o;try{s=e,o=t,console.error(v(e,t))}finally{r.__wbindgen_free(s,o,1)}},n.wbg.__wbindgen_object_drop_ref=function(e){m(e)},n.wbg.__wbg_crypto_c48a774b022d20ac=function(e){const t=_(e).crypto;return a(t)},n.wbg.__wbindgen_is_object=function(e){const t=_(e);return typeof t=="object"&&t!==null},n.wbg.__wbg_process_298734cf255a885d=function(e){const t=_(e).process;return a(t)},n.wbg.__wbg_versions_e2e78e134e3e5d01=function(e){const t=_(e).versions;return a(t)},n.wbg.__wbg_node_1cd7a5d853dbea79=function(e){const t=_(e).node;return a(t)},n.wbg.__wbindgen_is_string=function(e){return typeof _(e)=="string"},n.wbg.__wbg_msCrypto_bcb970640f50a1e8=function(e){const t=_(e).msCrypto;return a(t)},n.wbg.__wbg_require_8f08ceecec0f4fee=function(){return u(function(){const e=module.require;return a(e)},arguments)},n.wbg.__wbindgen_is_function=function(e){return typeof _(e)=="function"},n.wbg.__wbg_getRandomValues_37fa2ca9e4e07fab=function(){return u(function(e,t){_(e).getRandomValues(_(t))},arguments)},n.wbg.__wbg_randomFillSync_dc1e9a60c158336d=function(){return u(function(e,t){_(e).randomFillSync(m(t))},arguments)},n.wbg.__wbg_newnoargs_581967eacc0e2604=function(e,t){const s=new Function(v(e,t));return a(s)},n.wbg.__wbg_call_cb65541d95d71282=function(){return u(function(e,t){const s=_(e).call(_(t));return a(s)},arguments)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=_(e);return a(t)},n.wbg.__wbg_self_1ff1d729e9aae938=function(){return u(function(){const e=self.self;return a(e)},arguments)},n.wbg.__wbg_window_5f4faef6c12b79ec=function(){return u(function(){const e=window.window;return a(e)},arguments)},n.wbg.__wbg_globalThis_1d39714405582d3c=function(){return u(function(){const e=globalThis.globalThis;return a(e)},arguments)},n.wbg.__wbg_global_651f05c6a0944d1c=function(){return u(function(){const e=global.global;return a(e)},arguments)},n.wbg.__wbindgen_is_undefined=function(e){return _(e)===void 0},n.wbg.__wbg_call_01734de55d61e11d=function(){return u(function(e,t,s){const o=_(e).call(_(t),_(s));return a(o)},arguments)},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=_(e).buffer;return a(t)},n.wbg.__wbg_newwithbyteoffsetandlength_6da8e527659b86aa=function(e,t,s){const o=new Uint8Array(_(e),t>>>0,s>>>0);return a(o)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(_(e));return a(t)},n.wbg.__wbg_set_5cf90238115182c3=function(e,t,s){_(e).set(_(t),s>>>0)},n.wbg.__wbg_newwithlength_e5d69174d6984cd7=function(e){const t=new Uint8Array(e>>>0);return a(t)},n.wbg.__wbg_subarray_13db269f57aa838d=function(e,t,s){const o=_(e).subarray(t>>>0,s>>>0);return a(o)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(v(e,t))},n.wbg.__wbindgen_memory=function(){const e=r.memory;return a(e)},n}function j(n,e){return r=n.exports,L.__wbindgen_wasm_module=e,p=null,b=null,r}async function L(n){if(r!==void 0)return r;typeof n>"u"&&(n=new URL(""+new URL("htmf_wasm_bg-541f300d.wasm",import.meta.url).href,self.location));const e=F();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:s}=await x(await n,e);return j(t,s)}const N=2,z=0,A=1,T=8,D=7,C=8,Y=D*(T/2)+C*(T/2),G=100,V=0,E=14e3,B=6e4;function H(n){const e=[];for(let i=0;i<Y;++i)e.push(n.num_fish(i));const t=[],s=[],o=[];for(let i=0;i<N;++i)t.push(n.score(i)),s.push([...n.penguins(i)]),o.push([...n.claimed(i)]);return{activePlayer:n.active_player(),modeType:n.finished_drafting()?"playing":"drafting",scores:t,turn:n.turn(),board:{fish:e,penguins:s,claimed:o}}}function X(n,e){if(n.active_player()!==z)return[];if(n.finished_drafting()){if(e!==void 0)return[...n.possible_moves(e)];const t=n.active_player();return t===void 0?[]:[...n.penguins(t)]}else return[...n.draftable_cells()]}class ${wasmInternals;game;postMessage;ponderer;nplayouts=0;constructor(e,t){this.wasmInternals=e,this.postMessage=t,this.game=y.new(),this.ponder()}free(){this.stopPondering(),this.game.free()}reset(){this.free(),this.game=y.new(),this.ponder(),this.init()}init(){const e=this.postMessage;e({type:"initialized",gameState:this.getState(),possibleMoves:this.getPossibleMoves()})}ponder(){this.nplayouts=this.game.get_visits(),this.ponderer===void 0&&(this.ponderer=self.setInterval(()=>{if(this.nplayouts>=B){this.stopPondering();return}const e=performance.now();for(;performance.now()-e<G;)this.playout();const t=this.game.active_player();t!==void 0&&(this.game.is_drafting()?this.postPlaceScores(t):this.postMoveScores(t))},V))}stopPondering(){this.ponderer!==void 0&&(clearInterval(this.ponderer),this.ponderer=void 0)}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout(),++this.nplayouts}takeAction(){this.stopPondering();const e=this.postMessage,t=this.game.turn()<2?2*E:E,s=performance.now();for(;this.nplayouts<t;)this.playout(),this.nplayouts%100===0&&(e({type:"thinkingProgress",completed:this.nplayouts,required:t,totalTimeMs:performance.now()-s}),this.game.is_drafting()?this.postPlaceScores(A):this.postMoveScores(A));this.game.take_action(),this.ponder()}getState(){return H(this.game)}getPossibleMoves(e){return X(this.game,e)}onMessage(e){switch(console.log(`received request ${e.type}`),e.type){case"get":this.postGameState();break;case"move":try{this.movePenguin(e.src,e.dst),this.postGameState()}catch{this.postIllegalMove(e.src,e.dst)}break;case"place":try{this.placePenguin(e.dst),this.postGameState()}catch{this.postIllegalPlacement(e.dst)}break;case"possibleMoves":this.postPossibleMoves(e.src);break;case"takeAction":this.takeAction(),this.postGameState();break}}postIllegalMove(e,t){const s=this.postMessage;s({type:"illegalMove",src:e,dst:t})}postIllegalPlacement(e){const t=this.postMessage;t({type:"illegalPlacement",dst:e})}postPossibleMoves(e){const t=this.postMessage;t({type:"possibleMoves",possibleMoves:this.getPossibleMoves(e)})}postGameState(){const e=this.postMessage;e({type:"state",gameState:this.getState()})}postPlaceScores(e){const t=[];for(const o of this.game.draftable_cells()){const i=this.game.place_info(o);t.push({dst:o,visits:i.get_visits(),rewards:i.get_rewards()})}const s=this.postMessage;s({type:"placeScores",activePlayer:e,placeScores:t,memoryUsage:this.wasmInternals.memory.buffer.byteLength,treeSize:this.game.tree_size()})}postMoveScores(e){const t=[];for(const o of this.game.penguins(e))for(const i of this.game.possible_moves(o)){const g=this.game.move_info(o,i);t.push({src:o,dst:i,visits:g.get_visits(),rewards:g.get_rewards()})}const s=this.postMessage;s({type:"moveScores",activePlayer:e,moveScores:t,memoryUsage:this.wasmInternals.memory.buffer.byteLength,treeSize:this.game.tree_size()})}}const J=await L(),R=new $(J,postMessage);onmessage=n=>{R.onMessage(n.data)};R.init();
//# sourceMappingURL=bot.worker-da8fd5f2.js.map
