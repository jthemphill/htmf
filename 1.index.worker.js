self.webpackChunk([1],[,function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const s=o(n(4)),u=n(7);t.default=class{constructor(e){this.game=s.Game.new(),this.postMessage=e,this.nplayouts=0}free(){this.stopPondering(),this.game.free()}init(){const e=this.postMessage;e({type:"state",gameState:this.getState()}),e({type:"possibleMoves",possibleMoves:this.getPossibleMoves()})}ponder(){this.nplayouts=0,null==this.ponderer&&(this.ponderer=self.setInterval(()=>{if(this.nplayouts>=u.MAX_PLAYOUTS)return void this.stopPondering();const e=performance.now();for(;performance.now()-e<u.PLAYOUT_MS;)this.playout()},u.PONDER_INTERVAL_MS))}stopPondering(){null!=this.ponderer&&(self.clearInterval(this.ponderer),this.ponderer=void 0)}placePenguin(e){this.game.place_penguin(e),this.ponder()}movePenguin(e,t){this.game.move_penguin(e,t),this.ponder()}playout(){this.game.playout(),++this.nplayouts}takeAction(){for(this.stopPondering();this.nplayouts<u.MAX_PLAYOUTS;)this.playout();this.game.take_action(),this.ponder()}getState(){return function(e){const t=[];for(let n=0;n<u.NUM_CELLS;++n)t.push(e.num_fish(n));const n=[],r=[],i=[];for(let t=0;t<u.NPLAYERS;++t)n.push(e.score(t)),r.push([...e.penguins(t)]),i.push([...e.claimed(t)]);return{activePlayer:e.active_player(),modeType:e.finished_drafting()?"playing":"drafting",scores:n,turn:e.turn(),board:{fish:t,penguins:r,claimed:i}}}(this.game)}getPossibleMoves(e){return function(e,t){if(e.active_player()!=u.HUMAN_PLAYER)return[];if(e.finished_drafting()){if(null!=t)return[...e.possible_moves(t)];const n=e.active_player();return null==n?[]:[...e.penguins(n)]}return[...e.draftable_cells()]}(this.game,e)}onMessage(e){switch(console.log("received request "+e.type),e.type){case"get":this.postGameState();break;case"move":try{this.movePenguin(e.src,e.dst),this.postGameState()}catch(t){this.postIllegalMove(e.src,e.dst)}break;case"place":try{this.placePenguin(e.dst),this.postGameState()}catch(t){this.postIllegalPlacement(e.dst)}break;case"possibleMoves":this.postPossibleMoves(e.src);break;case"takeAction":this.takeAction(),this.postGameState()}}postIllegalMove(e,t){(0,this.postMessage)({type:"illegalMove",src:e,dst:t})}postIllegalPlacement(e){(0,this.postMessage)({type:"illegalPlacement",dst:e})}postPossibleMoves(e){(0,this.postMessage)({type:"possibleMoves",possibleMoves:this.getPossibleMoves(e)})}postGameState(){(0,this.postMessage)({type:"state",gameState:this.getState()})}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return y})),n.d(t,"n",(function(){return m})),n.d(t,"f",(function(){return w})),n.d(t,"j",(function(){return P})),n.d(t,"c",(function(){return M})),n.d(t,"l",(function(){return O})),n.d(t,"e",(function(){return A})),n.d(t,"g",(function(){return E})),n.d(t,"i",(function(){return L})),n.d(t,"h",(function(){return R})),n.d(t,"b",(function(){return N})),n.d(t,"k",(function(){return k})),n.d(t,"d",(function(){return T})),n.d(t,"o",(function(){return U})),n.d(t,"m",(function(){return Y}));var r=n(3);let i=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});i.decode();let o=null;function s(){return null!==o&&o.buffer===r.w.buffer||(o=new Uint8Array(r.w.buffer)),o}function u(e,t){return i.decode(s().subarray(e,e+t))}const c=new Array(32).fill(void 0);c.push(void 0,null,!0,!1);let a=c.length;function l(e){a===c.length&&c.push(c.length+1);const t=a;return a=c[t],c[t]=e,t}function f(e){return c[e]}function d(e){const t=f(e);return function(e){e<36||(c[e]=a,a=e)}(e),t}let p=null;function _(){return null!==p&&p.buffer===r.w.buffer||(p=new Int32Array(r.w.buffer)),p}function h(e,t){return s().subarray(e/1,e/1+t)}let g=0;let b=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const v="function"==typeof b.encodeInto?function(e,t){return b.encodeInto(e,t)}:function(e,t){const n=b.encode(e);return t.set(n),{read:e.length,written:n.length}};class y{static __wrap(e){const t=Object.create(y.prototype);return t.ptr=e,t}free(){const e=this.ptr;this.ptr=0,r.a(e)}static new(){var e=r.n();return y.__wrap(e)}is_drafting(){return 0!==r.l(this.ptr)}finished_drafting(){return 0!==r.j(this.ptr)}game_over(){return 0!==r.k(this.ptr)}active_player(){var e=r.g(this.ptr);return 16777215===e?void 0:e}score(e){return r.t(this.ptr,e)>>>0}turn(){return r.v(this.ptr)>>>0}num_fish(e){return r.o(this.ptr,e)>>>0}penguins(e){try{const o=r.c.value-16;r.c.value=o,r.p(o,this.ptr,e);var t=_()[o/4+0],n=_()[o/4+1],i=h(t,n).slice();return r.d(t,1*n),i}finally{r.c.value+=16}}claimed(e){try{const o=r.c.value-16;r.c.value=o,r.h(o,this.ptr,e);var t=_()[o/4+0],n=_()[o/4+1],i=h(t,n).slice();return r.d(t,1*n),i}finally{r.c.value+=16}}draftable_cells(){try{const i=r.c.value-16;r.c.value=i,r.i(i,this.ptr);var e=_()[i/4+0],t=_()[i/4+1],n=h(e,t).slice();return r.d(e,1*t),n}finally{r.c.value+=16}}possible_moves(e){try{const o=r.c.value-16;r.c.value=o,r.s(o,this.ptr,e);var t=_()[o/4+0],n=_()[o/4+1],i=h(t,n).slice();return r.d(t,1*n),i}finally{r.c.value+=16}}place_penguin(e){r.q(this.ptr,e)}move_penguin(e,t){r.m(this.ptr,e,t)}playout(){r.r(this.ptr)}take_action(){r.u(this.ptr)}}const m=function(e,t){return l(u(e,t))},w=function(){return l(new Error)},P=function(e,t){var n=function(e,t,n){if(void 0===n){const n=b.encode(e),r=t(n.length);return s().subarray(r,r+n.length).set(n),g=n.length,r}let r=e.length,i=t(r);const o=s();let u=0;for(;u<r;u++){const t=e.charCodeAt(u);if(t>127)break;o[i+u]=t}if(u!==r){0!==u&&(e=e.slice(u)),i=n(i,r,r=u+3*e.length);const t=s().subarray(i+u,i+r);u+=v(e,t).written}return g=u,i}(f(t).stack,r.e,r.f),i=g;_()[e/4+1]=i,_()[e/4+0]=n},M=function(e,t){try{console.error(u(e,t))}finally{r.d(e,t)}},O=function(e){d(e)},A=function(e,t,n){f(e).getRandomValues(h(t,n))},E=function(e,t,n){f(e).randomFillSync(h(t,n))},L=(S=function(){return l(self.self)},function(){try{return S.apply(this,arguments)}catch(e){r.b(l(e))}});var S;const R=function(e,t){return l(n(6)(u(e,t)))},N=function(e){return l(f(e).crypto)},k=function(e){return void 0===f(e)},T=function(e){return l(f(e).getRandomValues)},U=function(e,t){throw new Error(u(e,t))},Y=function(e){throw d(e)}}).call(this,n(5)(e))},function(e,t,n){"use strict";var r=n.w[e.i];e.exports=r;n(2);r.x()},function(e,t,n){"use strict";n.r(t);var r=n(2);n.d(t,"Game",(function(){return r.a})),n.d(t,"__wbindgen_string_new",(function(){return r.n})),n.d(t,"__wbg_new_59cb74e423758ede",(function(){return r.f})),n.d(t,"__wbg_stack_558ba5917b466edd",(function(){return r.j})),n.d(t,"__wbg_error_4bb6c2a97407129a",(function(){return r.c})),n.d(t,"__wbindgen_object_drop_ref",(function(){return r.l})),n.d(t,"__wbg_getRandomValues_f5e14ab7ac8e995d",(function(){return r.e})),n.d(t,"__wbg_randomFillSync_d5bd2d655fdf256a",(function(){return r.g})),n.d(t,"__wbg_self_1b7a39e3a92c949c",(function(){return r.i})),n.d(t,"__wbg_require_604837428532a733",(function(){return r.h})),n.d(t,"__wbg_crypto_968f1772287e2df0",(function(){return r.b})),n.d(t,"__wbindgen_is_undefined",(function(){return r.k})),n.d(t,"__wbg_getRandomValues_a3d34b4fee3c2869",(function(){return r.d})),n.d(t,"__wbindgen_throw",(function(){return r.o})),n.d(t,"__wbindgen_rethrow",(function(){return r.m}))},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=6},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PONDER_INTERVAL_MS=t.MAX_PLAYOUTS=t.PLAYOUT_MS=t.PLAYER_COLORS=t.NUM_CELLS=t.ODD_ROW_LEN=t.EVEN_ROW_LEN=t.NUM_ROWS=t.BOT_PLAYER=t.HUMAN_PLAYER=t.NPLAYERS=void 0;t.NPLAYERS=2;t.HUMAN_PLAYER=0;t.BOT_PLAYER=1;t.NUM_ROWS=8;t.EVEN_ROW_LEN=7;t.ODD_ROW_LEN=8;t.NUM_CELLS=60;t.PLAYOUT_MS=100;t.PONDER_INTERVAL_MS=0;t.MAX_PLAYOUTS=6e3;t.PLAYER_COLORS=["blue","red","orange","green"]}]);